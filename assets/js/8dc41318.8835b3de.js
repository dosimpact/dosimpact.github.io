"use strict";(self.webpackChunkdosimpact_blog=self.webpackChunkdosimpact_blog||[]).push([[81390],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>v});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var a=o.createContext({}),c=function(e){var n=o.useContext(a),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=c(e.components);return o.createElement(a.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,a=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(t),m=r,v=u["".concat(a,".").concat(m)]||u[m]||d[m]||s;return t?o.createElement(v,l(l({ref:n},p),{},{components:t})):o.createElement(v,l({ref:n},p))}));function v(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,l=new Array(s);l[0]=m;var i={};for(var a in n)hasOwnProperty.call(n,a)&&(i[a]=n[a]);i.originalType=e,i[u]="string"==typeof e?e:r,l[1]=i;for(var c=2;c<s;c++)l[c]=t[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},91154:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var o=t(87462),r=(t(67294),t(3905));const s={sidebar_position:2},l="NestJS env \uc124\uc815",i={unversionedId:"g-be/nest/ne002",id:"g-be/nest/ne002",title:"NestJS env \uc124\uc815",description:"env \uac1c\uc694",source:"@site/docs/g-be/1-nest/ne002.md",sourceDirName:"g-be/1-nest",slug:"/g-be/nest/ne002",permalink:"/docs/g-be/nest/ne002",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-be/1-nest/ne002.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"backEnd",previous:{title:"NestJS \uc2dc\uc791",permalink:"/docs/g-be/nest/ne001"},next:{title:"NestJS PostgreSQL \uc124\uce58",permalink:"/docs/g-be/nest/ne003-typeorm-01"}},a={},c=[{value:"env \uac1c\uc694",id:"env-\uac1c\uc694",level:2},{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"package.json \ubcc0\uacbd",id:"packagejson-\ubcc0\uacbd",level:3},{value:".env \ud30c\uc77c \uc0dd\uc131",id:"env-\ud30c\uc77c-\uc0dd\uc131",level:3},{value:"configMoudle \uc7a5\ucc29",id:"configmoudle-\uc7a5\ucc29",level:2},{value:"Joi",id:"joi",level:3},{value:"configMoudle \uc0ac\uc6a9",id:"configmoudle-\uc0ac\uc6a9",level:2},{value:"main.ts\uc5d0\uc11c configService \uc0ac\uc6a9",id:"maints\uc5d0\uc11c-configservice-\uc0ac\uc6a9",level:3},{value:"\uc694\uc57d \ubc0f \uc608\uc81c",id:"\uc694\uc57d-\ubc0f-\uc608\uc81c",level:2},{value:"ref",id:"ref",level:2}],p={toc:c},u="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"nestjs-env-\uc124\uc815"},"NestJS env \uc124\uc815"),(0,r.kt)("head",null,(0,r.kt)("meta",{name:"keywords",content:"NestJS"})),(0,r.kt)("h2",{id:"env-\uac1c\uc694"},"env \uac1c\uc694"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Node.js\uc5d0\uc11c \uae30\ubcf8\uc801\uc73c\ub85c dotenv\ub97c \uc0ac\uc6a9\ud588\uc5c8\ub2e4.  "),(0,r.kt)("li",{parentName:"ul"},"Nest JS \uc5d0\uc11c\ub3c4 \ud658\uacbd\ubcc0\uc218\ub97c \ub2e4\ub8e8\ub294 \ube4c\ud2b8\uc778 ConfigModule\uc774 \uc788\ub2e4. \ub0b4\ubd80\uc801\uc73c\ub85c dotenv\ub97c \uc0ac\uc6a9\ud55c\ub2e4.   "),(0,r.kt)("li",{parentName:"ul"},"cross-env \uc124\uce58 : \ud06c\ub85c\uc2a4 \ud50c\ub81b\ud3fc\uc758 env\uc5d0 \ub300\uc751\ud560 \uc218 \uc788\ub2e4.",(0,r.kt)("br",{parentName:"li"}),"(\uac01 \ud50c\ub7ab\ud3fc \ubcc4\ub85c \ud658\uacbd \ubcc0\uc218\ub97c \uba39\uc774\ub294 \uba85\ub839\uc5b4\uac00 \ub2e4\ub974\uc9c0\ub9cc cross-env\ub97c \uc0ac\uc6a9\ud558\uba74 \ub41c\ub2e4.)   "),(0,r.kt)("li",{parentName:"ul"},"Joi env\uc5d0 \ud0c0\uc785 \ubc0f \uc720\ud6a8\uc131 \uac80\uc0ac  ")),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"\uc124\uce58"},"\uc124\uce58"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm i --save @nestjs/config  cross-env joi\nor\nyarn add @nestjs/config  cross-env joi\n")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"packagejson-\ubcc0\uacbd"},"package.json \ubcc0\uacbd"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"NODE_ENV\ub77c\ub294 \ud658\uacbd\ubcc0\uc218\uac00 \uc8fc\uc785\ub418\uc5b4 \ud504\ub85c\uc138\uc2a4\uac00 \uc2e4\ud589 \ub41c\ub2e4.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'    "build": "cross-env NODE_ENV=production nest build",\n    "start:dev": "cross-env NODE_ENV=dev nest start --watch",\n    "start:prod": "cross-env NODE_ENV=production node dist/main",\n')),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"env-\ud30c\uc77c-\uc0dd\uc131"},".env \ud30c\uc77c \uc0dd\uc131"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ud658\uacbd\ubcc0\uc218 \ud30c\uc77c\uc744 \ub9cc\ub4e4\uc790."),(0,r.kt)("li",{parentName:"ul"},"local, dev, stage, qa, test, prod \ub4f1 \uac01 \ud658\uacbd\uc5d0 \ub9de\uac8c \ud658\uacbd\ubcc0\uc218\ub97c \ub9cc\ub4e4 \uc218 \uc788\ub2e4.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"// \ud658\uacbd \ubcc0\uc218 \uc124\uc815 \ud30c\uc77c \ub9cc\ub4e4\uae30\n// .env.dev\nhello=world\nPORT=3001\n")),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"configmoudle-\uc7a5\ucc29"},"configMoudle \uc7a5\ucc29"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// app.module.ts\nimport { ConfigModule } from '@nestjs/config';\nimport * as Joi from 'joi';\n\n// NODE_ENV\ub294 cross-env\uc5d0 \uc8fc\uc785\ub418\uc5b4 \ubcf4\uc774\uc9c0\ub9cc, \ub098\uba38\uc9c0\ub294 ConfigModule\uc5d0 \uc758\ud574 \uad00\ub9ac\ub41c\ub2e4.\nconsole.log('--\x3eprocess.env.NODE_ENV', process.env.NODE_ENV);// dev\nconsole.log('--\x3eprocess.env.hello', process.env.hello); // undefined\nconsole.log('--\x3eprocess.env.PORT', process.env.PORT); // undefined\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      // \uae00\ub85c\ubc8c \ubaa8\ub4c8 \uc120\uc5b8\n      isGlobal: true, \n      // \ud658\uacbd\ubcc0\uc218\uc5d0 \ub530\ub978 .env\ud30c\uc77c \uad00\ub9ac\n      envFilePath: process.env.NODE_ENV === 'dev' ? '.env.dev' : '.env.prod',\n      // heroku\ub4f1 \uc678\ubd80 sass\uc5d0 \uc758\ud574 \ud658\uacbd\ubcc0\uc218\uac00 \uad00\ub9ac\ub418\ub294 \uacbd\uc6b0\n      ignoreEnvFile: process.env.NODE_ENV === 'production',\n      // Joi validator\n      validationSchema: Joi.object({\n        NODE_ENV: Joi.string().valid('dev', 'production').default('dev'),\n        PORT: Joi.number().default(3000),\n      }),\n    }),\n    HelloModule,\n    UsersModule,\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n\n")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"joi"},"Joi"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"joi , The most powerful schema description language and data validator for JavaScript."),(0,r.kt)("li",{parentName:"ul"},"JS \ubaa8\ub4c8\uc774\uace0 index.d.ts \ub85c \uc815\uc758\ub428 > \uc784\ud3ec\ud2b8\uc2dc * \uc0ac\uc6a9\ud560\uac83")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { ConfigModule } from '@nestjs/config';\nimport * as Joi from 'joi';\n\n    ConfigModule.forRoot({\n      validationSchema: Joi.object({\n        NODE_ENV: Joi.string().valid('dev', 'production').default('dev'),\n        PORT: Joi.number().default(3000),\n      }),\n    }),\n")),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"configmoudle-\uc0ac\uc6a9"},"configMoudle \uc0ac\uc6a9"),(0,r.kt)("p",null,"global module\ub85c \uc120\uc5b8\uc744 \ud588\uae30\ub584\ubb38\uc5d0, \uc11c\ube44\uc2a4\uc758 \uc0dd\uc131\uc790\uc5d0\uc11c configService\ub97c \uc8fc\uc785\ubc1b\uc744 \uc218 \uc788\ub2e4.  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// users.service.ts\nimport { ConfigService } from '@nestjs/config';\n\n@Injectable()\nexport class UsersService {\n  constructor(private readonly config: ConfigService) {}\n\n  findAll() {\n    // --\x3ethis.config.get('hello') world\n    console.log(\"--\x3ethis.config.get('hello')\", this.config.get('hello'));\n\n    return `This action returns all users`;\n  }\n}\n\n")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"maints\uc5d0\uc11c-configservice-\uc0ac\uc6a9"},"main.ts\uc5d0\uc11c configService \uc0ac\uc6a9"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { ConfigService } from '@nestjs/config';\nimport { log } from 'console';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  const configService = app.get(ConfigService);\n  const port = configService.get('PORT');\n  log('--\x3eport', port); // 3001\n\n  await app.listen(port || 3000);\n}\nbootstrap();\n\n")),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"\uc694\uc57d-\ubc0f-\uc608\uc81c"},"\uc694\uc57d \ubc0f \uc608\uc81c"),(0,r.kt)("p",null,"\uc694\uc57d"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"cross-env\ub85c NODE_ENV \uc8fc\uc785"),(0,r.kt)("li",{parentName:"ul"},"DB \uc815\ubcf4\ub97c .env\ub85c \uc62e\uae40"),(0,r.kt)("li",{parentName:"ul"},"joi \ub85c \uc720\ud6a8\uc131 \uac80\uc0ac \uc2e4\ud589"),(0,r.kt)("li",{parentName:"ul"},"DB \ub294 \ud558\ub098\uc758 URL \ub85c \ub9cc\ub4e4\uc5b4 \ub450\ub294 \uac83\uc744 \ucd94\ucc9c ( heroku \ub791 \uac19\uc740 env value\ub85c \ub450\uba74 \ud3b8\ud568 )")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { Module } from \'@nestjs/common\';\nimport * as Joi from \'joi\';\nimport { ConfigModule } from \'@nestjs/config\';\nimport { GraphQLModule } from \'@nestjs/graphql\';\nimport { TypeOrmModule } from \'@nestjs/typeorm\';\nimport { RestaurantsModule } from \'./restaurants/restaurants.module\';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      isGlobal: true,\n      envFilePath: process.env.NODE_ENV === "dev" ? ".env.dev" : ".env.test",\n      ignoreEnvFile: process.env.NODE_ENV === \'prod\', // \ub2e4\ub978\ubc29\ubc95\uc73c\ub85c env\ub97c \uc5bb\ub294\ub2e4. heroku \uc124\uc815\ub4f1\n      validationSchema: Joi.object({\n        NODE_ENV: Joi.string().valid(\'dev\', \'prod\'),\n        DB_HOST: Joi.string().required(),\n        DB_PORT: Joi.string().required(), // \ucc98\uc74c\uc5d0\ub294 string\uc73c\ub85c \ub4e4\uc5b4\uc634\n        DB_USERNAME: Joi.string().required(),\n        DB_PASSWORD: Joi.string().required(),\n        DB_NAME: Joi.string().required(),\n      })\n    }),\n    GraphQLModule.forRoot({\n      autoSchemaFile: true,//join(process.cwd(), \'src/schema.gql\'),\n    }),\n    TypeOrmModule.forRoot({\n      "type": "postgres",\n      "host": process.env.DB_HOST,\n      "port": +process.env.DB_PORT, // env \uc124\uc815\uc740 string\uc73c\ub85c \uc628\ub2e4. + \ub97c \ubd99\uc774\uba74 number\uac00 \ub41c\ub2e4.\n      "username": process.env.DB_USERNAME,\n      "password": process.env.DB_PASSWORD,\n      "database": process.env.DB_NAME,\n      "synchronize": true, // db\uc5f0\uacb0\uacfc \ub3d9\uc2dc\uc5d0 model migration \uc2e4\ud589\n      "logging": true,\n    }),\n    RestaurantsModule,],\n  controllers: [],\n  providers: [],\n})\nexport class AppModule { }\n\n')),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"ref"},"ref"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.nestjs.com/techniques/configuration"},"https://docs.nestjs.com/techniques/configuration"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/cross-env"},"https://www.npmjs.com/package/cross-env"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/joi"},"https://www.npmjs.com/package/joi")))}d.isMDXComponent=!0}}]);