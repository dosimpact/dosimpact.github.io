"use strict";(self.webpackChunkdosimpact_blog=self.webpackChunkdosimpact_blog||[]).push([[24924],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),d=u(n),h=r,m=d["".concat(c,".").concat(h)]||d[h]||p[h]||i;return n?a.createElement(m,s(s({ref:t},l),{},{components:n})):a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=h;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[d]="string"==typeof e?e:r,s[1]=o;for(var u=2;u<i;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},50877:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const i={sidebar_position:3},s="Supabase DDL Template",o={unversionedId:"g-fe/next+supa/next3-DDL-3",id:"g-fe/next+supa/next3-DDL-3",title:"Supabase DDL Template",description:"- Supabase DDL Template",source:"@site/docs/g-fe/6-next+supa/next3-DDL-3.md",sourceDirName:"g-fe/6-next+supa",slug:"/g-fe/next+supa/next3-DDL-3",permalink:"/docs/g-fe/next+supa/next3-DDL-3",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-fe/6-next+supa/next3-DDL-3.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"frontEnd",previous:{title:"Supabase DDL",permalink:"/docs/g-fe/next+supa/next3-DDL-2"},next:{title:"Supabase RLS",permalink:"/docs/g-fe/next+supa/next3-RLS-1"}},c={},u=[{value:"eg) Todo",id:"eg-todo",level:2},{value:"eg) AI Chat",id:"eg-ai-chat",level:2},{value:"eg) stripe",id:"eg-stripe",level:2}],l={toc:u},d="wrapper";function p(e){let{components:t,...i}=e;return(0,r.kt)(d,(0,a.Z)({},l,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"supabase-ddl-template"},"Supabase DDL Template"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#supabase-ddl-template"},"Supabase DDL Template"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#eg-todo"},"eg) Todo")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#eg-ai-chat"},"eg) AI Chat")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#eg-stripe"},"eg) stripe"))))),(0,r.kt)("h2",{id:"eg-todo"},"eg) Todo"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:n(27088).Z,width:"1523",height:"300"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'--\n-- For use with:\n-- https://github.com/supabase/supabase/tree/master/examples/todo-list/sveltejs-todo-list or\n-- https://github.com/supabase/examples-archive/tree/main/supabase-js-v1/todo-list\n--\n\ncreate table todos (\n  id bigint generated by default as identity primary key,\n  user_id uuid references auth.users not null,\n  task text check (char_length(task) > 3),\n  is_complete boolean default false,\n  inserted_at timestamp with time zone default timezone(\'utc\'::text, now()) not null\n);\n\n--  RLS \uc801\uc6a9\nalter table todos enable row level security;\n\ncreate policy "Individuals can create todos." on todos for\n    insert with check (auth.uid() = user_id);\n\ncreate policy "Individuals can view their own todos. " on todos for\n    select using (auth.uid() = user_id);\n\ncreate policy "Individuals can update their own todos." on todos for\n    update using (auth.uid() = user_id);\n\ncreate policy "Individuals can delete their own todos." on todos for\n    delete using (auth.uid() = user_id);\n\n')),(0,r.kt)("h2",{id:"eg-ai-chat"},"eg) AI Chat"),(0,r.kt)("p",null,"Tables : profiles chat suggestion document message vote",(0,r.kt)("br",{parentName:"p"}),"\n","datatype : boolean, uuid, varchar, text, json, timestamp with time zone   "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- Set schema to ai_chat_test\nSET search_path TO ai_chat_test;\n\n-- Create a table for public profiles\ncreate table ai_chat_test.profiles (\n  id uuid references auth.users on delete cascade not null primary key,\n  updated_at timestamp with time zone,\n  username text unique,\n  full_name text,\n  avatar_url text,\n  website text,\n\n  constraint username_length check (char_length(username) >= 3)\n);\n\n-- Set up Row Level Security (RLS)\n-- See https://supabase.com/docs/guides/auth/row-level-security for more details.\nalter table ai_chat_test.profiles\n  enable row level security;\n\ncreate policy \"Public profiles are viewable by everyone.\" on ai_chat_test.profiles\n  for select using (true);\n\ncreate policy \"Users can insert their own profile.\" on ai_chat_test.profiles\n  for insert with check ((select auth.uid()) = id);\n\ncreate policy \"Users can update own profile.\" on ai_chat_test.profiles\n  for update using ((select auth.uid()) = id);\n\n-- This trigger automatically creates a profile entry when a new user signs up via Supabase Auth.\n-- See https://supabase.com/docs/guides/auth/managing-user-data#using-triggers for more details.\ncreate function ai_chat_test.handle_new_user()\nreturns trigger\nset search_path = 'ai_chat_test'\nas $$\nbegin\n  insert into ai_chat_test.profiles (id, full_name, avatar_url)\n  values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');\n  return new;\nend;\n$$ language plpgsql security definer;\n\ncreate trigger on_auth_user_created_to_ai_chat_test\n  after insert on auth.users\n  for each row execute procedure ai_chat_test.handle_new_user();\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'-- Set schema to ai_chat_test\nSET search_path TO ai_chat_test;\n\nCREATE TABLE IF NOT EXISTS ai_chat_test.chat (\n    "id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n    "createdAt" timestamp NOT NULL,\n    "messages" json NOT NULL,\n    "userId" uuid NOT NULL\n);\n\n--\x3e statement-breakpoint\nDO $$ BEGIN\n    ALTER TABLE ai_chat_test.chat\n    ADD CONSTRAINT "chat_userId_profiles_id_fk"\n    FOREIGN KEY ("userId") REFERENCES ai_chat_test.profiles(id) ON DELETE NO ACTION ON UPDATE NO ACTION;\nEXCEPTION\n    WHEN duplicate_object THEN NULL;\nEND $$;\n\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'-- Set schema to ai_chat_test\nSET search_path TO ai_chat_test;\n\nCREATE TABLE IF NOT EXISTS ai_chat_test."suggestion" (\n    "id" uuid DEFAULT gen_random_uuid() NOT NULL,\n    "documentId" uuid NOT NULL,\n    "documentCreatedAt" timestamp NOT NULL,\n    "originalText" text NOT NULL,\n    "suggestedText" text NOT NULL,\n    "description" text,\n    "isResolved" boolean DEFAULT false NOT NULL,\n    "userId" uuid NOT NULL,\n    "createdAt" timestamp NOT NULL,\n    CONSTRAINT "suggestion_id_pk" PRIMARY KEY("id")\n);\n\nCREATE TABLE IF NOT EXISTS ai_chat_test."document" (\n    "id" uuid DEFAULT gen_random_uuid() NOT NULL,\n    "createdAt" timestamp NOT NULL,\n    "title" text NOT NULL,\n    "content" text,\n    "userId" uuid NOT NULL,\n    CONSTRAINT "document_id_createdAt_pk" PRIMARY KEY("id","createdAt")\n);\n\nDO $$ BEGIN\n ALTER TABLE ai_chat_test."suggestion" ADD CONSTRAINT "suggestion_userId_profiles_id_fk" FOREIGN KEY ("userId") REFERENCES "ai_chat_test"."profiles"("id") ON DELETE no action ON UPDATE no action;\nEXCEPTION\n WHEN duplicate_object THEN null;\nEND $$;\n\nDO $$ BEGIN\n ALTER TABLE ai_chat_test."suggestion" ADD CONSTRAINT "suggestion_documentId_documentCreatedAt_document_id_createdAt_fk" FOREIGN KEY ("documentId","documentCreatedAt") REFERENCES "ai_chat_test"."document"("id","createdAt") ON DELETE no action ON UPDATE no action;\nEXCEPTION\n WHEN duplicate_object THEN null;\nEND $$;\n\nDO $$ BEGIN\n ALTER TABLE ai_chat_test."document" ADD CONSTRAINT "document_userId_profiles_id_fk" FOREIGN KEY ("userId") REFERENCES "ai_chat_test"."profiles"("id") ON DELETE no action ON UPDATE no action;\nEXCEPTION\n WHEN duplicate_object THEN null;\nEND $$;\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'-- Set schema to ai_chat_test\nSET search_path TO ai_chat_test;  \n\nCREATE TABLE IF NOT EXISTS ai_chat_test."message" (\n    "id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\n    "chatId" uuid NOT NULL,\n    "role" varchar NOT NULL,\n    "content" json NOT NULL,\n    "createdAt" timestamp NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS ai_chat_test."vote" (\n    "chatId" uuid NOT NULL,\n    "messageId" uuid NOT NULL,\n    "isUpvoted" boolean NOT NULL,\n    CONSTRAINT "vote_chatId_messageId_pk" PRIMARY KEY("chatId","messageId")\n);\n\nALTER TABLE ai_chat_test."chat" ADD COLUMN "title" text NOT NULL;\n\nDO $$ BEGIN\n ALTER TABLE ai_chat_test."message" ADD CONSTRAINT "message_chatId_chat_id_fk" FOREIGN KEY ("chatId") REFERENCES "ai_chat_test"."chat"("id") ON DELETE no action ON UPDATE no action;\nEXCEPTION\n WHEN duplicate_object THEN null;\nEND $$;\n\nDO $$ BEGIN\n ALTER TABLE ai_chat_test."vote" ADD CONSTRAINT "vote_chatId_chat_id_fk" FOREIGN KEY ("chatId") REFERENCES "ai_chat_test"."chat"("id") ON DELETE no action ON UPDATE no action;\nEXCEPTION\n WHEN duplicate_object THEN null;\nEND $$;\n\nDO $$ BEGIN\n ALTER TABLE ai_chat_test."vote" ADD CONSTRAINT "vote_messageId_message_id_fk" FOREIGN KEY ("messageId") REFERENCES "ai_chat_test"."message"("id") ON DELETE no action ON UPDATE no action;\nEXCEPTION\n WHEN duplicate_object THEN null;\nEND $$;\n\nALTER TABLE ai_chat_test."chat" DROP COLUMN IF EXISTS "messages";\n\n')),(0,r.kt)("h2",{id:"eg-stripe"},"eg) stripe"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"/**\n* USERS\n* Note: This table contains user data. Users should only be able to view and update their own data.\n*/\ncreate table users (\n  -- UUID from auth.users\n  id uuid references auth.users not null primary key,\n  full_name text,\n  avatar_url text,\n  -- The customer's billing address, stored in JSON format.\n  billing_address jsonb,\n  -- Stores your customer's payment instruments.\n  payment_method jsonb\n);\nalter table users\n  enable row level security;\ncreate policy \"Can view own user data.\" on users\n  for select using (auth.uid() = id);\ncreate policy \"Can update own user data.\" on users\n  for update using (auth.uid() = id);\n\n/**\n* This trigger automatically creates a user entry when a new user signs up via Supabase Auth.\n*/\ncreate function public.handle_new_user()\nreturns trigger as\n$$\n  begin\n    insert into public.users (id, full_name, avatar_url)\n    values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');\n    return new;\n  end;\n$$\nlanguage plpgsql security definer;\n\ncreate trigger on_auth_user_created\n  after insert on auth.users\n  for each row\n    execute procedure public.handle_new_user();\n\n/**\n* CUSTOMERS\n* Note: this is a private table that contains a mapping of user IDs to Strip customer IDs.\n*/\ncreate table customers (\n  -- UUID from auth.users\n  id uuid references auth.users not null primary key,\n  -- The user's customer ID in Stripe. User must not be able to update this.\n  stripe_customer_id text\n);\nalter table customers enable row level security;\n-- No policies as this is a private table that the user must not have access to.\n\n/**\n* PRODUCTS\n* Note: products are created and managed in Stripe and synced to our DB via Stripe webhooks.\n*/\ncreate table products (\n  -- Product ID from Stripe, e.g. prod_1234.\n  id text primary key,\n  -- Whether the product is currently available for purchase.\n  active boolean,\n  -- The product's name, meant to be displayable to the customer. Whenever this product is sold via a subscription, name will show up on associated invoice line item descriptions.\n  name text,\n  -- The product's description, meant to be displayable to the customer. Use this field to optionally store a long form explanation of the product being sold for your own rendering purposes.\n  description text,\n  -- A URL of the product image in Stripe, meant to be displayable to the customer.\n  image text,\n  -- Set of key-value pairs, used to store additional information about the object in a structured format.\n  metadata jsonb\n);\nalter table products\n  enable row level security;\ncreate policy \"Allow public read-only access.\" on products\n  for select using (true);\n\n/**\n* PRICES\n* Note: prices are created and managed in Stripe and synced to our DB via Stripe webhooks.\n*/\ncreate type pricing_type as enum ('one_time', 'recurring');\ncreate type pricing_plan_interval as enum ('day', 'week', 'month', 'year');\ncreate table prices (\n  -- Price ID from Stripe, e.g. price_1234.\n  id text primary key,\n  -- The ID of the prduct that this price belongs to.\n  product_id text references products,\n  -- Whether the price can be used for new purchases.\n  active boolean,\n  -- A brief description of the price.\n  description text,\n  -- The unit amount as a positive integer in the smallest currency unit (e.g., 100 cents for US$1.00 or 100 for \xa5100, a zero-decimal currency).\n  unit_amount bigint,\n  -- Three-letter ISO currency code, in lowercase.\n  currency text check (char_length(currency) = 3),\n  -- One of `one_time` or `recurring` depending on whether the price is for a one-time purchase or a recurring (subscription) purchase.\n  type pricing_type,\n  -- The frequency at which a subscription is billed. One of `day`, `week`, `month` or `year`.\n  interval pricing_plan_interval,\n  -- The number of intervals (specified in the `interval` attribute) between subscription billings. For example, `interval=month` and `interval_count=3` bills every 3 months.\n  interval_count integer,\n  -- Default number of trial days when subscribing a customer to this price using [`trial_from_plan=true`](https://stripe.com/docs/api#create_subscription-trial_from_plan).\n  trial_period_days integer,\n  -- Set of key-value pairs, used to store additional information about the object in a structured format.\n  metadata jsonb\n);\nalter table prices\n  enable row level security;\ncreate policy \"Allow public read-only access.\" on prices\n  for select using (true);\n\n/**\n* SUBSCRIPTIONS\n* Note: subscriptions are created and managed in Stripe and synced to our DB via Stripe webhooks.\n*/\ncreate type subscription_status as enum ('trialing', 'active', 'canceled', 'incomplete', 'incomplete_expired', 'past_due', 'unpaid');\ncreate table subscriptions (\n  -- Subscription ID from Stripe, e.g. sub_1234.\n  id text primary key,\n  user_id uuid references auth.users not null,\n  -- The status of the subscription object, one of subscription_status type above.\n  status subscription_status,\n  -- Set of key-value pairs, used to store additional information about the object in a structured format.\n  metadata jsonb,\n  -- ID of the price that created this subscription.\n  price_id text references prices,\n  -- Quantity multiplied by the unit amount of the price creates the amount of the subscription. Can be used to charge multiple seats.\n  quantity integer,\n  -- If true the subscription has been canceled by the user and will be deleted at the end of the billing period.\n  cancel_at_period_end boolean,\n  -- Time at which the subscription was created.\n  created timestamp with time zone default timezone('utc'::text, now()) not null,\n  -- Start of the current period that the subscription has been invoiced for.\n  current_period_start timestamp with time zone default timezone('utc'::text, now()) not null,\n  -- End of the current period that the subscription has been invoiced for. At the end of this period, a new invoice will be created.\n  current_period_end timestamp with time zone default timezone('utc'::text, now()) not null,\n  -- If the subscription has ended, the timestamp of the date the subscription ended.\n  ended_at timestamp with time zone default timezone('utc'::text, now()),\n  -- A date in the future at which the subscription will automatically get canceled.\n  cancel_at timestamp with time zone default timezone('utc'::text, now()),\n  -- If the subscription has been canceled, the date of that cancellation. If the subscription was canceled with `cancel_at_period_end`, `canceled_at` will still reflect the date of the initial cancellation request, not the end of the subscription period when the subscription is automatically moved to a canceled state.\n  canceled_at timestamp with time zone default timezone('utc'::text, now()),\n  -- If the subscription has a trial, the beginning of that trial.\n  trial_start timestamp with time zone default timezone('utc'::text, now()),\n  -- If the subscription has a trial, the end of that trial.\n  trial_end timestamp with time zone default timezone('utc'::text, now())\n);\nalter table subscriptions\n  enable row level security;\ncreate policy \"Can only view own subs data.\" on subscriptions\n  for select using (auth.uid() = user_id);\n\n/**\n * REALTIME SUBSCRIPTIONS\n * Only allow realtime listening on public tables.\n */\ndrop publication if exists supabase_realtime;\ncreate publication supabase_realtime\n  for table products, prices;\n\n")))}p.isMDXComponent=!0},27088:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-3-bc11713ad177715f65bb00df752f5d14.png"}}]);