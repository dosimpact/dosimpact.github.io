"use strict";(self.webpackChunkdosimpact_blog=self.webpackChunkdosimpact_blog||[]).push([[82517],{3905:(e,n,r)=>{r.d(n,{Zo:()=>m,kt:()=>_});var t=r(67294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function s(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=t.createContext({}),c=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):s(s({},n),e)),r},m=function(e){var n=c(e.components);return t.createElement(l.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),u=c(r),d=a,_=u["".concat(l,".").concat(d)]||u[d]||p[d]||o;return r?t.createElement(_,s(s({ref:n},m),{},{components:r})):t.createElement(_,s({ref:n},m))}));function _(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[u]="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=r[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,r)}d.displayName="MDXCreateElement"},6161:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var t=r(87462),a=(r(67294),r(3905));const o={sidebar_position:2},s="Zod",i={unversionedId:"g-fe/react/thrid-party/thrid-2-zod",id:"g-fe/react/thrid-party/thrid-2-zod",title:"Zod",description:"- Zod",source:"@site/docs/g-fe/4-react/5-thrid-party/thrid-2-zod.md",sourceDirName:"g-fe/4-react/5-thrid-party",slug:"/g-fe/react/thrid-party/thrid-2-zod",permalink:"/docs/g-fe/react/thrid-party/thrid-2-zod",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-fe/4-react/5-thrid-party/thrid-2-zod.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"frontEnd",previous:{title:"\ucc44\ub110\ud1a1 \uc5f0\ub3d9\ud558\uae30",permalink:"/docs/g-fe/react/thrid-party/thrid-1-channeltalk"},next:{title:"6.NextJS",permalink:"/docs/category/6nextjs"}},l={},c=[{value:"\uc18c\uac1c",id:"\uc18c\uac1c",level:2},{value:"Infra Code",id:"infra-code",level:2},{value:"usage",id:"usage",level:2},{value:"usu - refine, filetype",id:"usu---refine-filetype",level:3},{value:"eg",id:"eg",level:2},{value:"eg - Schema Number",id:"eg---schema-number",level:3},{value:"eg - Shame object, UserSchema",id:"eg---shame-object-userschema",level:3},{value:"eg - gpt tools",id:"eg---gpt-tools",level:3},{value:"eg) streamObject",id:"eg-streamobject",level:3}],m={toc:c},u="wrapper";function p(e){let{components:n,...r}=e;return(0,a.kt)(u,(0,t.Z)({},m,r,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"zod"},"Zod"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#zod"},"Zod"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#%EC%86%8C%EA%B0%9C"},"\uc18c\uac1c")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#infra-code"},"Infra Code")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#usage"},"usage"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#usu---refine-filetype"},"usu - refine, filetype")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#eg"},"eg"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#eg---schema-number"},"eg - Schema Number")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#eg---shame-object-userschema"},"eg - Shame object, UserSchema")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#eg---gpt-tools"},"eg - gpt tools")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#eg-streamobject"},"eg) streamObject"))))))),(0,a.kt)("h2",{id:"\uc18c\uac1c"},"\uc18c\uac1c"),(0,a.kt)("p",null,"\ubaa9\uc801 : \uc2a4\ud0a4\ub9c8 \uc120\uc5b8 \ubc0f \ub370\uc774\ud130 \uac80\uc99d \ub77c\uc774\ube0c\ub7ec\ub9ac",(0,a.kt)("br",{parentName:"p"}),"\n","\uc608 : API \uc751\ub2f5, \ud3fc \ub370\uc774\ud130, \ud658\uacbd \ubcc0\uc218 \ub4f1\uc758 \uc720\ud6a8\uc131 \uac80\uc0ac",(0,a.kt)("br",{parentName:"p"}),"\n","\uc7a5\uc810 : "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"TypeScript \uae30\ubc18 \ud0c0\uc785\ucd94\ub860 \uae30\ub2a5, (\ub7f0\ud0c0\uc784 \uc720\ud6a8\uc131 \uac80\uc0ac \uac00\ub2a5)  "),(0,a.kt)("li",{parentName:"ul"},"\ud655\uc7a5\uc131 \uc88b\uc74c ( refine, \t\uac1d\uccb4, \ubc30\uc5f4, union, intersection, optional \ub4f1 \ub2e4\uc591\ud55c \uad6c\uc870\ub97c \uc798 \ucc98\ub9ac. )",(0,a.kt)("br",{parentName:"li"}),"\ub2e8\uc810  "),(0,a.kt)("li",{parentName:"ul"},"\uc758\uc874\uc131 \ud544\ub4dc\ub4e4\uc740 refine \uc5d0 \ub9ce\uc774 \uc758\uc874\ud55c\ub2e4.  ")),(0,a.kt)("h2",{id:"infra-code"},"Infra Code"),(0,a.kt)("p",null,"\uc124\uacc4  "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"1.\uc2a4\ud0a4\ub9c8 \uc815\uc758\ubd80",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\uc870\uac74\ubd80 \uc758\uc874\uc131 \uac80\uc0ac \ub300\uc751\uc744 \uc704\ud574, refine\uc5d0 \ub4e4\uc5b4\uac00\ub294 \uc778\uc790\ub97c create \ud568\uc218\ub85c \ubc1b\ub294\ub2e4.   "),(0,a.kt)("li",{parentName:"ul"},"\ub3c4\uba54\uc778 \ub2e8\uc704\ub85c \uc2a4\ud0a4\ub9c8\ub97c \uc815\uc758\ud55c\ub2e4.  "))),(0,a.kt)("li",{parentName:"ul"},"2.\uc2e4\ud589\ubd80",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"validate, hooks \uc81c\uacf5  ")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// validateWithZod\nimport { z } from "zod";\n\nexport function validateWithZod<T>(schema: z.ZodSchema, data: T): string[] {\n  const errors: string[] = [];\n\n  try {\n    schema.parse(data);\n  } catch (e) {\n    if (e instanceof z.ZodError) {\n      errors.push(...e.errors.map((e) => e.message));\n    }\n  }\n\n  return errors;\n}\n\n\n// useZodValidator\nimport { useEffect, useMemo, useState } from "react";\nimport type { z } from "zod";\nimport { validateWithZod } from "./validateWithzod";\n\nexport function useZodValidator<T>(zodSchema: z.ZodSchema, value: T) {\n  const [errors, setErrors] = useState<Array<string>>([]);\n\n  const schema = useMemo(() => zodSchema, [zodSchema]);\n\n  const hasError = errors?.length >= 1;\n\n  useEffect(() => {\n    const validationErrors = validateWithZod(schema, value);\n    setErrors(validationErrors);\n  }, [value, schema]);\n\n  return { errors, hasError };\n}\n\n--- \n// str.schema.ts\nimport { z } from "zod";\n\nexport const STR_ERROR = {\n  NOT_VALID_EMAIL: "NOT_VALID_EMAIL",\n  NOT_VALID_URL: "NOT_VALID_URL",\n};\n\nexport const createEmailErrorSchema = () =>\n  z.string().email({\n    message: STR_ERROR.NOT_VALID_EMAIL,\n  });\n\nexport const createUrlErrorSchema = () =>\n  z.string().url({\n    message: STR_ERROR.NOT_VALID_URL,\n  });\n\n\n// price.schema.ts\nimport { z } from "zod";\n\nexport const SchemaMsgEnum = {\n  ERROR_MSG_PRICE: "ERROR_MSG_PRICE",\n  ERROR_MSG_PRICE_LIMIT: "ERROR_MSG_PRICE_LIMIT",\n};\n\nconst PRICE_LOWER_LIMIT = 10_000;\nconst PRICE_UPPER_LIMIT = 1_000_000_000;\n\nexport const createPriceErrorSchema = () =>\n  z\n    .number({ message: SchemaMsgEnum.ERROR_MSG_PRICE })\n    .optional() // \uc5c6\uc5b4\ub3c4 \ub418\ub294 \uac12, \ud558\uc9c0\ub9cc \uc788\uc73c\uba74 \uac80\uc0ac\ub97c \ud55c\ub2e4.\n    .nullable() // null \uac12\ub3c4 \ud5c8\uc6a9\ud55c\ub2e4.\n    .refine(\n      // \uac12\uc774 \uc788\ub2e4\uba74 \ubc18\ub4dc\uc2dc \uc544\ub798 \uc870\uac74\uc774 \ub9cc\uc871 \ub418\uc5b4\uc57c \ud55c\ub2e4.\n      (value) => {\n        if (value === undefined || value === null) return true;\n        return value >= PRICE_LOWER_LIMIT && value <= PRICE_UPPER_LIMIT;\n      },\n      {\n        message: SchemaMsgEnum.ERROR_MSG_PRICE_LIMIT,\n      },\n    );\n\n// user.schema.ts\n\nimport { z } from "zod";\nimport { createEmailErrorSchema, createUrlErrorSchema } from "./str.schema";\n\nexport const USER_ERROR = {\n  NOT_VALID_EMAIL: "NOT_VALID_EMAIL",\n  NOT_VALID_URL: "NOT_VALID_URL",\n  NOT_VALID_PASSWORD: "NOT_VALID_PASSWORD",\n  NOT_VALID_PASSWORD_UPPER_CASE: "NOT_VALID_PASSWORD_UPPER_CASE",\n  NOT_VALID_PASSWORD_LOWER_CASE: "NOT_VALID_PASSWORD_LOWER_CASE",\n  NOT_VALID_PASSWORD_NUMBER: "NOT_VALID_PASSWORD_NUMBER",\n  NOT_VALID_USERNAME: "NOT_VALID_USERNAME",\n  NOT_VALID_USERNAME_MAX: "NOT_VALID_USERNAME_MAX",\n};\n\nexport const createUsernameErrorSchema = () =>\n  z\n    .string()\n    .min(3, {\n      message: USER_ERROR.NOT_VALID_USERNAME,\n    })\n    .max(10, {\n      message: USER_ERROR.NOT_VALID_USERNAME_MAX,\n    });\n\nexport const createPasswordErrorSchema = () =>\n  z\n    .string()\n    .min(0, {\n      message: USER_ERROR.NOT_VALID_PASSWORD,\n    })\n    .regex(/[A-Z]/, {\n      message: USER_ERROR.NOT_VALID_PASSWORD_UPPER_CASE,\n    })\n    .regex(/[a-z]/, {\n      message: USER_ERROR.NOT_VALID_PASSWORD_LOWER_CASE,\n    })\n    .regex(/[0-9]/, {\n      message: USER_ERROR.NOT_VALID_PASSWORD_NUMBER,\n    });\n\nexport const createUserErrorSchema = () =>\n  z.object({\n    email: createEmailErrorSchema(),\n    url: createUrlErrorSchema().optional(),\n    username: createUsernameErrorSchema(),\n    password: createPasswordErrorSchema(),\n  });\n\n\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const UserSchema = z.object({\n  name: z.string(),\n  email: z.string().email(),\n});\ntype User = z.infer<typeof UserSchema>;\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ai-sdk\uc640 \uc5f0\ub3d9\ud574\uc11c \uc0ac\uc6a9 \uac00\ub2a5, json \uc2a4\ud0a4\ub9c8 \ubaa8\ub4dc\uc5d0 zod\ub97c \uc5f0\uacb0\ud558\uc5ec \ubcf5\uc7a1\ud55c \uad6c\uc870\uc758 \uc751\ub2f5 \uac00\ub2a5.  ")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"usage"},"usage"),(0,a.kt)("h3",{id:"usu---refine-filetype"},"usu - refine, filetype"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"refine : \uc815\uc81c\ud558\ub2e4 ( \ud30c\uc77c\uc758 \uc6a9\ub7c9, \uc774\ubbf8\uc9c0 \ud0c0\uc785 \ub4f1 \uc815\uc758\uac00\ub2a5)  ")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// Use Blob instead of File since File is not available in Node.js environment\nconst FileSchema = z.object({\n  file: z\n    .instanceof(Blob)\n    .refine((file) => file.size <= 5 * 1024 * 1024, {\n      message: "File size should be less than 5MB",\n    })\n    // Update the file type based on the kind of files you want to accept\n    .refine((file) => ["image/jpeg", "image/png"].includes(file.type), {\n      message: "File type should be JPEG or PNG",\n    }),\n});\n\n')),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"eg"},"eg"),(0,a.kt)("h3",{id:"eg---schema-number"},"eg - Schema Number"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { z } from 'zod';\n\nexport const SchemaMsgEnum = {\n  ERROR_MSG_NOT_NUMBER: 'ERROR_MSG_NOT_NUMBER',\n  ERROR_MSG_POINT_LIMIT: 'ERROR_MSG_POINT_LIMIT'\n};\n\nconst POINT_LOWER_LIMIT = 10_000;\nconst POINT_UPPER_LIMIT = 1_000_000_000;\n\nexport const createPointErrorSchema = () =>\n  z.number({ message: SchemaMsgEnum.ERROR_MSG_NOT_NUMBER }) // \ub118\ubc84\ud0c0\uc785\uc774 \uc544\ub2d0\uacbd\uc6b0\uc758 \uc624\ub958   \n    .optional() // undefined \ud5c8\uc6a9\n    .nullable() // null \ud5c8\uc6a9  \n    .refine(\n    value => {\n      // * refine\uc740 \uc704\uc5d0\uc11c \uac78\ub9ac\uc9c0 \uc54a\ub294 \uc774\uc0c1 (\ubb38\uc790\uc5f4\ub4f1\uc5d0 \uac78\ub824\uc11c ERROR_MSG_NOT_NUMBER \uc560\ub7ec \ub4f1) \uc2e4\ud589\ub41c\ub2e4.  \n      if (value === undefined || value === null) return true;  // optional, nullable \ub2e4\uc2dc \uccb4\ud06c\ud574\uc57c\ud568.  \n      return value >= POINT_LOWER_LIMIT && value <= POINT_UPPER_LIMIT;\n    },\n    {\n      message: SchemaMsgEnum.ERROR_MSG_POINT_LIMIT\n    }\n  );\n\ncreatePointErrorSchema().parse(null) // no error\ncreatePointErrorSchema().parse(undefined) // no error\ncreatePointErrorSchema().parse('awef') // error ERROR_MSG_NOT_NUMBER\ncreatePointErrorSchema().parse(0) // error ERROR_MSG_POINT_LIMIT\ncreatePointErrorSchema().parse(10_000) // no error\ncreatePointErrorSchema().parse(1_000_000_000) //  no error\ncreatePointErrorSchema().parse(1_000_000_001) // error ERROR_MSG_POINT_LIMIT\n")),(0,a.kt)("h3",{id:"eg---shame-object-userschema"},"eg - Shame object, UserSchema"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"z.object : \uac1d\uccb4\uc758 \uad6c\uc870 \uc815\uc758  "),(0,a.kt)("li",{parentName:"ul"},"UserSchema.parse(body) : \uc720\ud6a8\uc131 \uac80\uc0ac \uc218\ud589  "),(0,a.kt)("li",{parentName:"ul"},"error instanceof z.ZodError, error.issue : \uc720\ud6a8\uc131 \uac80\uc0ac \uc2e4\ud328 \uc560\ub7ec  ")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// TS : app/api/hello/route.ts\nimport { z } from "zod";\n\n// 1.\uc2a4\ud0a4\ub9c8 \uc815\uc758\nconst UserSchema = z.object({\n  name: z.string().min(3, { message: "\ucd5c\uc18c 3\uae00\uc790" }),\n  email: z.string().email({ message: "\uc62c\ubc14\ub978 \uc774\uba54\uc77c \ud615\uc2dd\uc774 \uc544\ub2c8\ub2e4." }),\n});\n\nexport const POST = async (request: Request) => {\n  try {\n    const body = await request.json();\n    // 2.\uc2a4\ud0a4\ub9c8 \ud14c\uc2a4\ud2b8  \n    const user = UserSchema.parse(body);\n\n    return NextResponse.json({\n      success: true,\n      user,\n    });\n  } catch (error) {\n    console.error(error);\n\n    // SyntaxError: Unexpected end of JSON input\n    if (error instanceof SyntaxError) {\n      return NextResponse.json(\n        { error: "Invalid JSON format" },\n        { status: 400 }\n      );\n    }\n\n    // 3.zod error\n    if (error instanceof z.ZodError) {\n      const errorMessages = error.issues\n        .map((issue) => issue.message)\n        .join(", ");\n\n      return NextResponse.json(\n        { error: "Invalid user data : " + errorMessages },\n        { status: 400 }\n      );\n    }\n\n    // internal server error\n    return NextResponse.json(\n      { error: "Internal server error" },\n      { status: 500 }\n    );\n  }\n};\n\n')),(0,a.kt)("h3",{id:"eg---gpt-tools"},"eg - gpt tools"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"free weahter api : ",(0,a.kt)("a",{parentName:"li",href:"https://api.open-meteo.com/v1/forecast?latitude=38&longitude=123&current=temperature_2m&hourly=temperature_2m&daily=sunrise,sunset&timezone=auto"},"https://api.open-meteo.com/v1/forecast?latitude=38&longitude=123","\xa4","t=temperature_2m&hourly=temperature_2m&daily=sunrise,sunset&timezone=auto"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'  const result = await streamText({\n    model: customModel(model.apiIdentifier),\n    system: systemPrompt,\n    messages: coreMessages,\n    maxSteps: 5,\n    experimental_activeTools: allTools,\n    tools: {\n      getWeather: {\n        description: "Get the current weather at a location",\n        // zod \uc758 \uc2a4\ud0a4\ub9c8 \uc815\uc758\ub97c \ud30c\ub77c\ubbf8\ud130\uc5d0 \ub123\ub294\ub2e4.  \n        parameters: z.object({\n          latitude: z.number(),\n          longitude: z.number(),\n        }),\n        execute: async ({ latitude, longitude }) => {\n          const response = await fetch(\n            `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m&hourly=temperature_2m&daily=sunrise,sunset&timezone=auto`\n          );\n\n          const weatherData = await response.json();\n          return weatherData;\n        },\n      },\n')),(0,a.kt)("h3",{id:"eg-streamobject"},"eg) streamObject"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const { elementStream } = await streamObject({\n  model: customModel(model.apiIdentifier),\n  system:\n    "You are a help writing assistant. Given a piece of writing, please offer suggestions to improve the piece of writing and describe the change. It is very important for the edits to contain full sentences instead of just words. Max 5 suggestions.",\n  prompt: document.content,\n  output: "array",\n  schema: z.object({\n    originalSentence: z.string().describe("The original sentence"),\n    suggestedSentence: z.string().describe("The suggested sentence"),\n    description: z\n      .string()\n      .describe("The description of the suggestion"),\n  }),\n});\n')))}p.isMDXComponent=!0}}]);