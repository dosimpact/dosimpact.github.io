"use strict";(self.webpackChunkdosimpact_blog=self.webpackChunkdosimpact_blog||[]).push([[61162],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),l=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):d(d({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(i.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,g=u["".concat(i,".").concat(m)]||u[m]||p[m]||a;return n?o.createElement(g,d(d({ref:t},c),{},{components:n})):o.createElement(g,d({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,d=new Array(a);d[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:r,d[1]=s;for(var l=2;l<a;l++)d[l]=n[l];return o.createElement.apply(null,d)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},52017:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>d,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=n(87462),r=(n(67294),n(3905));const a={sidebar_position:2},d="2.Zustand Patterns",s={unversionedId:"g-fe/react/zustand/zustand-2",id:"g-fe/react/zustand/zustand-2",title:"2.Zustand Patterns",description:"- 2.Zustand Patterns",source:"@site/docs/g-fe/4-react/3-zustand/zustand-2.md",sourceDirName:"g-fe/4-react/3-zustand",slug:"/g-fe/react/zustand/zustand-2",permalink:"/docs/g-fe/react/zustand/zustand-2",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-fe/4-react/3-zustand/zustand-2.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"frontEnd",previous:{title:"1.Zustand Basic",permalink:"/docs/g-fe/react/zustand/zustand-1"},next:{title:"3.Zustand Patterns",permalink:"/docs/g-fe/react/zustand/zustand-3"}},i={},l=[{value:"Typing",id:"typing",level:2},{value:"State, Actions \uc744 \ubd84\ub9ac\ud574\uc11c \ud0c0\uc785 \uc815\uc758",id:"state-actions-\uc744-\ubd84\ub9ac\ud574\uc11c-\ud0c0\uc785-\uc815\uc758",level:3},{value:"\ub0b4\ubd80 \ub85c\uc9c1 \ucd94\uc0c1\ud654",id:"\ub0b4\ubd80-\ub85c\uc9c1-\ucd94\uc0c1\ud654",level:3},{value:"\ub78c\ub2e4 \ud65c\uc6a9",id:"\ub78c\ub2e4-\ud65c\uc6a9",level:3},{value:"\uc720\ud2f8\uc131 \uacf5\ud1b5 \ub85c\uc9c1 \uc7ac\uc0ac\uc6a9",id:"\uc720\ud2f8\uc131-\uacf5\ud1b5-\ub85c\uc9c1-\uc7ac\uc0ac\uc6a9",level:3},{value:"\uc561\uc158 in \uc561\uc158 \uc7ac\uc0ac\uc6a9",id:"\uc561\uc158-in-\uc561\uc158-\uc7ac\uc0ac\uc6a9",level:3},{value:"immer \ubd88\ud3b8\uc131 \uad00\ub9ac middleware",id:"immer-\ubd88\ud3b8\uc131-\uad00\ub9ac-middleware",level:3}],c={toc:l},u="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"2zustand-patterns"},"2.Zustand Patterns"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#2zustand-patterns"},"2.Zustand Patterns"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#typing"},"Typing"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#state-actions-%EC%9D%84-%EB%B6%84%EB%A6%AC%ED%95%B4%EC%84%9C-%ED%83%80%EC%9E%85-%EC%A0%95%EC%9D%98"},"State, Actions \uc744 \ubd84\ub9ac\ud574\uc11c \ud0c0\uc785 \uc815\uc758")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%EB%82%B4%EB%B6%80-%EB%A1%9C%EC%A7%81-%EC%B6%94%EC%83%81%ED%99%94"},"\ub0b4\ubd80 \ub85c\uc9c1 \ucd94\uc0c1\ud654")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%EB%9E%8C%EB%8B%A4-%ED%99%9C%EC%9A%A9"},"\ub78c\ub2e4 \ud65c\uc6a9")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%EC%9C%A0%ED%8B%B8%EC%84%B1-%EA%B3%B5%ED%86%B5-%EB%A1%9C%EC%A7%81-%EC%9E%AC%EC%82%AC%EC%9A%A9"},"\uc720\ud2f8\uc131 \uacf5\ud1b5 \ub85c\uc9c1 \uc7ac\uc0ac\uc6a9")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%EC%95%A1%EC%85%98-in-%EC%95%A1%EC%85%98-%EC%9E%AC%EC%82%AC%EC%9A%A9"},"\uc561\uc158 in \uc561\uc158 \uc7ac\uc0ac\uc6a9")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#immer-%EB%B6%88%ED%8E%B8%EC%84%B1-%EA%B4%80%EB%A6%AC-middleware"},"immer \ubd88\ud3b8\uc131 \uad00\ub9ac middleware"))))))),(0,r.kt)("h2",{id:"typing"},"Typing"),(0,r.kt)("h3",{id:"state-actions-\uc744-\ubd84\ub9ac\ud574\uc11c-\ud0c0\uc785-\uc815\uc758"},"State, Actions \uc744 \ubd84\ub9ac\ud574\uc11c \ud0c0\uc785 \uc815\uc758"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ud0c0\uc785 \uc790\uccb4\ub97c \ubd84\ub9ac\ud574\uc11c \uc0c1\ud0dc\uc640 \ud589\ub3d9\uc744 \uad6c\ubd84    "),(0,r.kt)("li",{parentName:"ul"},"store\uac00 \ub9ce\uc774 \ucee4\uc9c0\uba74 \ud589\ub3d9 \uac1d\uccb4\ub97c \ubd84\ub9ac  ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"action, builder, validator \ub4f1  ")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// Todo \ud56d\ubaa9 \ud0c0\uc785\nexport type TodoItem = {\n  id: TodoId;\n  title?: string | null;\n  completed?: boolean | null;\n  ownerId?: string | null;\n};\nexport type TodoId = string;\n\n---\n\nexport type TodoStoreState = {\n  // \ub85c\uadf8\uc778\ud55c \uc720\uc800 \n  loggedUserId: string;\n  // \uc11c\ubc84\uc5d0\uc11c \ubd88\ub7ec\uc628 \ub9ac\uc2a4\ud2b8  \n  originalTodos: Record<TodoId, TodoItem>;\n  // \ubcc0\uacbd\ud55c \ub9ac\uc2a4\ud2b8  \n  todos: Record<TodoId, TodoItem>;\n};\n-- \n\nexport interface TodoStoreAction {\n  // \uc870\ud68c\n  getTodoById: (id: TodoId, fromOriginal?: boolean) => TodoItem | undefined;\n  getIsChangedTodo: (id: TodoId) => boolean;\n  getIsAnyChangedTodo: () => boolean;\n\n  // \uc218\uc815\n  setTodoById: (id: TodoId, next: TodoItem) => void;\n  setTodosByIds: (ids: TodoId[], patch: TodoItem) => void;\n  setLoggedUserId: (userId: string) => void;\n  deleteTodosByIds: (ids: TodoId[]) => void;\n\n  // \ub3d9\uae30\ud654\n  refreshTodos: (list: TodoItem[]) => void;\n\n  // DTO & Validation\n  buildUpsertTodoRequestDto: (args: { targetId: string; userId: string }) => {\n    targetId: string;\n    todos: Partial<TodoItem>[];\n  };\n  validateTodo: (id: TodoId) => string[];\n  validateAllTodos: () => { validateResult: Record<TodoId, string[]>; hasError: boolean };\n}\n\n\n\n// \ud655\uc2e4\ud558\uac8c \uad6c\ubd84 \ud558\ub294 \ub2e4\ub978 \ubc29\ubc95. (\ucc38\uace0)  \n\nimport { create } from 'zustand'\n\nexport const useCountStore = create<{\n  count: number\n  actions: {\n    increase: () => void\n    decrease: () => void\n  }\n}>(set => ({\n  count: 1,\n  actions: {\n    increase: () => set(state => ({ count: state.count + 1 })),\n    decrease: () => set(state => ({ count: state.count - 1 }))\n  }\n}))\n\n")),(0,r.kt)("h3",{id:"\ub0b4\ubd80-\ub85c\uc9c1-\ucd94\uc0c1\ud654"},"\ub0b4\ubd80 \ub85c\uc9c1 \ucd94\uc0c1\ud654"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import * as R from 'ramda';\nimport type { TodoItem } from './todo.store';\n\n// \ubaa8\ub4e0 \uc8fc\uc694 \ud544\ub4dc\uac00 \ube44\uc5b4\uc788\uc73c\uba74 true\nexport const isTodoFieldsFalsy = (todo: TodoItem) => !todo.title && R.isNil(todo.completed);\n\nexport const isStrictEqual = (a: unknown, b: unknown) => a === b;\n\nexport const isChangedTodo = (asis?: TodoItem, tobe?: TodoItem) => {\n  const Falsy = (v: boolean) => v === false;\n  \n  if (!R.isNil(asis) && !R.isNil(tobe)) {\n    return [\n      isStrictEqual(asis?.title, tobe?.title),\n      isStrictEqual(asis?.completed, tobe?.completed),\n    ].some(Falsy);\n  }\n\n  // \ub458 \uc911 \ud558\ub098\uac00 \ub2e4\ub978\uacbd\uc6b0 = True, Nil\ub85c \uac19\uc740 \uacbd\uc6b0 = False  \n  return R.isNil(asis) !== R.isNil(tobe);\n};\n---\nexport const useTodoStore = create<TodoStoreState & TodoStoreAction>()(\n  devtools((set, get) => ({\n    ...\n    getIsChangedTodo: (id) => {\n      const original = get().originalTodos[id];\n      const current = get().todos[id];\n      return isChangedTodo(original, current);\n    },\n  }))\n);\n")),(0,r.kt)("h3",{id:"\ub78c\ub2e4-\ud65c\uc6a9"},"\ub78c\ub2e4 \ud65c\uc6a9"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export const useTodoStore = create<TodoStoreState & TodoStoreAction>()(\n  devtools((set, get) => ({\n    // --- Remeda \ud30c\uc774\ud504 \uc720\uc9c0: values -> filter -> map -> mapValues -> pick ---\n    buildUpsertTodoRequestDto: ({ targetId, userId }) => {\n      const todosObj = get().todos;\n\n      const todos = pipe(\n        todosObj as Record<string, TodoItem>,\n        values,\n        filter((t) => {\n          const isChanged = get().getIsChangedTodo(t.id);\n          const isEditable = t?.ownerId ? t.ownerId === userId : true;\n          // \ubcc0\uacbd\ub41c \uac83 + \ubcf8\uc778 \uc18c\uc720\ub9cc \ud3ec\ud568\n          return isChanged && isEditable;\n        }),\n        map((t) => {\n          const id = t.id;\n          return {\n            ...t,\n            // \uc6d0\ubcf8\uacfc \ube44\uad50\ud574 \uc0c1\ud0dc\uac00 \ud544\uc694\ud558\ub2e4\uba74 \uacc4\uc0b0\ud574\uc11c \ud3ec\ud568 (\ud544\uc694 \uc5c6\uc73c\uba74 \uc81c\uac70)\n            todoStatus: getTodoStatus(get().getTodoById(id, true), t),\n          };\n        }),\n        map(\n          // placeholder \uac12 \uc81c\uac70\n          mapValues((v) => (isNullish(v) || v === '' ? null : v))\n        ),\n        map(\n          pick(['id', 'title', 'note', 'completed', 'isPrimary']) // \ud544\uc694 \ud544\ub4dc\ub9cc \uc804\uc1a1\n        )\n      );\n\n      return { targetId, todos };\n    },\n  }))\n);\n")),(0,r.kt)("h3",{id:"\uc720\ud2f8\uc131-\uacf5\ud1b5-\ub85c\uc9c1-\uc7ac\uc0ac\uc6a9"},"\uc720\ud2f8\uc131 \uacf5\ud1b5 \ub85c\uc9c1 \uc7ac\uc0ac\uc6a9"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// --- \uacf5\ud1b5 \ub85c\uc9c1 (\uad8c\ud55c \uccb4\ud06c) ---\nconst canEdit = (state: TodoStoreState, id: TodoId) => {...};\n// isPrimary \uc911\ubcf5 \uc81c\uac70 (true\ub294 \ud558\ub098\ub9cc)\nconst removeDuplicatedPrimary = (state: TodoStoreState, next: Partial<TodoItem>) => {...};\n\n// --- store ---\nexport const useTodoStore = create<TodoStoreState & TodoStoreAction>()(\n  devtools((set, get) => ({\n    // \ub2e8\uac74 \uc5c5\ub370\uc774\ud2b8\n    setTodoById: (id, patch) => {\n      set(_prev => {\n        let prev = R.clone(_prev) as TodoStoreState;\n\n        // \ud83d\udccc \uacf5\ud1b5\ub85c\uc9c1 - \uba54\uc778 \uccb4\ud06c\n        prev = removeDuplicatedPrimary(prev, { ...patch, id }); \n\n        // \ud83d\udccc \uacf5\ud1b5\ub85c\uc9c1 - \uad8c\ud55c \uccb4\ud06c\n        if (!canEdit(prev, id)) return prev;\n\n        const next = {\n          todos: {\n            ...prev.todos,\n            [id]: { id, ...(prev.todos[id] ?? {}), ...patch },\n          },\n        };\n        return next;\n      });\n    },\n\n    // \ub2e4\uac74 \uc5c5\ub370\uc774\ud2b8\n    setTodosByIds: (ids, patch) => {\n      set(_prev => {\n        let prev = R.clone(_prev) as TodoStoreState;\n\n        const repId = ids[ids.length - 1];\n        // \ud83d\udccc \uacf5\ud1b5\ub85c\uc9c1 - \uba54\uc778 \uccb4\ud06c\n        prev = removeDuplicatedPrimary(prev, { ...patch, id: repId }); \n\n        const updated = R.clone(prev.todos);\n\n        ids.forEach(id => {\n          // \ud83d\udccc \uacf5\ud1b5\ub85c\uc9c1 - \uad8c\ud55c \uccb4\ud06c\n          if (!canEdit(prev, id)) return;\n\n          updated[id] = {\n            id,\n            ...(updated[id] ?? {}),\n            ...patch,\n          };\n        });\n\n        return { todos: updated };\n      });\n    },\n  }))\n);\n")),(0,r.kt)("h3",{id:"\uc561\uc158-in-\uc561\uc158-\uc7ac\uc0ac\uc6a9"},"\uc561\uc158 in \uc561\uc158 \uc7ac\uc0ac\uc6a9"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"todo \ud558\ub098\ub97c \uac80\uc99d\ud558\ub294 \uc561\uc158\uc744 \ub9cc\ub4e4\uba74, todo list\ub97c \uac80\uc99d\ud558\ub294 \uc561\uc158\uc5d0 \uc7ac\ud65c\uc6a9 \uac00\ub2a5\ud558\ub2e4.  ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// 6.\uc561\uc158 in \uc561\uc158 \uc7ac\uc0ac\uc6a9\n// --- store ---\nexport const useTodoStore = create<TodoStoreState & TodoStoreAction>()(\n  devtools((set, get) => ({\n    todos: {},\n    // (\uc815\uc758) \ub2e8\uc77c \ud56d\ubaa9 \uac80\uc99d\n    validateTodoData: (id) => {\n      const data = get().todos[id];\n      if (!data) return [];\n      const parsed = createTodoErrorSchema().safeParse(data);\n      if (parsed.success) return [];\n      return parsed.error.issues.map(i => i.message);\n    },\n\n    // (\ud638\ucd9c) \uc804\uccb4 \uac80\uc99d: \uc561\uc158 \uc548\uc5d0\uc11c \uc561\uc158 \uc7ac\uc0ac\uc6a9\n    validateAllTodoData: () => {\n      const todos = get().todos;\n      const result: Record<TodoId, string[]> = {};\n\n      Object.keys(todos).forEach((id) => {\n        result[id as TodoId] = get().validateTodoData(id as TodoId); // \uc7ac\uc0ac\uc6a9!\n      });\n\n      const hasError = Object.values(result).some(errors => errors.length > 0);\n      return { validateResult: result, hasError };\n    },\n  }))\n);\n")),(0,r.kt)("h3",{id:"immer-\ubd88\ud3b8\uc131-\uad00\ub9ac-middleware"},"immer \ubd88\ud3b8\uc131 \uad00\ub9ac middleware"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// useTodoStore.immer.ts\nimport { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { immer } from 'zustand/middleware/immer';\n\nexport const useTodoStore = create<TodoStore>()(\n  devtools(\n    immer<TodoStore>((set) => ({\n      // --- State ---\n      todos: {},\n      isReadOnly: false,\n      editorModalOpen: false,\n      currentEditingId: undefined,\n      filter: 'all',\n\n      // --- Actions ---\n      addTodo: (title) =>\n        set((state) => {\n          const id = crypto.randomUUID?.() ?? String(Date.now());\n          state.todos[id] = { id, title, completed: false };\n        }),\n\n      updateTodo: (id, patch) =>\n        set((state) => {\n          const t = state.todos[id];\n          if (!t) return;\n          if (patch.title !== undefined) t.title = patch.title;\n          if (patch.completed !== undefined) t.completed = patch.completed;\n        }),\n\n      toggleTodo: (id) =>\n        set((state) => {\n          const t = state.todos[id];\n          if (t) t.completed = !t.completed;\n        }),\n\n      removeTodo: (id) =>\n        set((state) => {\n          delete state.todos[id];\n        }),\n\n      // UI/\uc124\uc815\n      setIsReadOnly: (v) =>\n        set((state) => {\n          state.isReadOnly = v;\n        }),\n\n      setEditorModalOpen: (open, id) =>\n        set((state) => {\n          state.editorModalOpen = open;\n          state.currentEditingId = open ? id : undefined;\n        }),\n\n      setFilter: (f) =>\n        set((state) => {\n          state.filter = f;\n        }),\n    })),\n    {\n      name: 'todoStore',\n      enabled: process.env.NODE_ENV !== 'production',\n    }\n  )\n);\n\n")))}p.isMDXComponent=!0}}]);