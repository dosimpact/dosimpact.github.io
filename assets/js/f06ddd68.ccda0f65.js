"use strict";(self.webpackChunkdosimpact_blog=self.webpackChunkdosimpact_blog||[]).push([[8613],{3905:(n,e,t)=>{t.d(e,{Zo:()=>u,kt:()=>g});var a=t(67294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function l(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function i(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},o=Object.keys(n);for(a=0;a<o.length;a++)t=o[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(a=0;a<o.length;a++)t=o[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var s=a.createContext({}),d=function(n){var e=a.useContext(s),t=e;return n&&(t="function"==typeof n?n(e):l(l({},e),n)),t},u=function(n){var e=d(n.components);return a.createElement(s.Provider,{value:e},n.children)},c="mdxType",p={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},f=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,o=n.originalType,s=n.parentName,u=i(n,["components","mdxType","originalType","parentName"]),c=d(t),f=r,g=c["".concat(s,".").concat(f)]||c[f]||p[f]||o;return t?a.createElement(g,l(l({ref:e},u),{},{components:t})):a.createElement(g,l({ref:e},u))}));function g(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var o=t.length,l=new Array(o);l[0]=f;var i={};for(var s in e)hasOwnProperty.call(e,s)&&(i[s]=e[s]);i.originalType=n,i[c]="string"==typeof n?n:r,l[1]=i;for(var d=2;d<o;d++)l[d]=t[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}f.displayName="MDXCreateElement"},80695:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var a=t(87462),r=(t(67294),t(3905));const o={sidebar_position:11},l="vectorbt - \ubd84\ud560\ub9e4\uc218 + MA Gap ZScore",i={unversionedId:"g-da/quant/vectorbt-labs/quant011",id:"g-da/quant/vectorbt-labs/quant011",title:"vectorbt - \ubd84\ud560\ub9e4\uc218 + MA Gap ZScore",description:"1Pager",source:"@site/docs/g-da/3-quant/5-vectorbt-labs/quant011.md",sourceDirName:"g-da/3-quant/5-vectorbt-labs",slug:"/g-da/quant/vectorbt-labs/quant011",permalink:"/docs/g-da/quant/vectorbt-labs/quant011",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-da/3-quant/5-vectorbt-labs/quant011.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11},sidebar:"dataAnalytics",previous:{title:"vectorbt - \ubcc0\ub3d9\uc131 \ub3cc\ud30c",permalink:"/docs/g-da/quant/vectorbt-labs/quant010"},next:{title:"vectorbt - \ubd84\ud560\ub9e4\uc218 + MA Gap ZScore 2",permalink:"/docs/g-da/quant/vectorbt-labs/quant012"}},s={},d=[{value:"1Pager",id:"1pager",level:2},{value:"Hypothesis",id:"hypothesis",level:3},{value:"Long Position",id:"long-position",level:3},{value:"Short Position",id:"short-position",level:3},{value:"Result - BTC/USDT, 1h",id:"result---btcusdt-1h",level:2},{value:"stats",id:"stats",level:3},{value:"Result - LINK/KRW, 1h - TC2",id:"result---linkkrw-1h---tc2",level:2},{value:"stats",id:"stats-1",level:3},{value:"Result - LINK/KRW, 1h - TC3",id:"result---linkkrw-1h---tc3",level:2},{value:"stats",id:"stats-2",level:3},{value:"Result - LINK/KRW, 1h - TC3",id:"result---linkkrw-1h---tc3-1",level:2},{value:"stats",id:"stats-3",level:3},{value:"Result - LINK/KRW, 1h - TC4",id:"result---linkkrw-1h---tc4",level:2},{value:"stats",id:"stats-4",level:3},{value:"Result - LINK/KRW, 1h - TC5",id:"result---linkkrw-1h---tc5",level:2},{value:"stats",id:"stats-5",level:3}],u={toc:d},c="wrapper";function p(n){let{components:e,...o}=n;return(0,r.kt)(c,(0,a.Z)({},u,o,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"vectorbt---\ubd84\ud560\ub9e4\uc218--ma-gap-zscore"},"vectorbt - \ubd84\ud560\ub9e4\uc218 + MA Gap ZScore"),(0,r.kt)("h2",{id:"1pager"},"1Pager"),(0,r.kt)("h3",{id:"hypothesis"},"Hypothesis"),(0,r.kt)("p",null,"1.\ud604\uc7ac \uac00\uaca9\uacfc \uc774\ub3d9\ud3c9\uade0\uc120 \uc0ac\uc774\uc758 Gap\uc774 \uc874\uc7ac\ud55c\ub2e4.  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uadf8 Gap\uc5d0 \ub300\ud55c \ub370\uc774\ud130\ub97c \uc0d8\ud50c\ub9c1 \ud55c\ub2e4.    "),(0,r.kt)("li",{parentName:"ul"},"Gap\ub370\uc774\ud130\ub97c \ubaa8\uc544\uc11c \ud3c9\uade0 \ubc0f \ud45c\uc900\uc815\uaddc\ubd84\ud3ec \uace1\uc120\uc744 \uadf8\ub9b0\ub2e4.",(0,r.kt)("br",{parentName:"li"}),(0,r.kt)("img",{alt:"Alt text",src:t(88781).Z,width:"1535",height:"342"})),(0,r.kt)("li",{parentName:"ul"},"\uadf8 \uc815\uaddc\ubd84\ud3ec\uace1\uc120\uc5d0\uc11c \ud558\uc704 1%\uc77c\ub54c\uac00 \ub9e4\uc218\ud558\uae30 \uc88b\uc740 \uc2dc\uc810\uc774\ub2e4.    "),(0,r.kt)("li",{parentName:"ul"},"\uc758\ubbf8 : \uc9c0\uae08\uae4c\uc9c0\uc758 Period \uc911 \uac00\uc7a5 \uc800\uac00\uc5d0 \ub9e4\uc218\ud558\ub294 \uac83  ")),(0,r.kt)("p",null,"\uc8fc\uc758  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uc0c1\uc2b9\uc7a5 only  "),(0,r.kt)("li",{parentName:"ul"},"\ucda9\ubd84\ud788 \ud559\uc2b5\uae30\uac04\uc774 \ud544\uc694\ud558\uae30\uc5d0 10\uc77c \uc774\uc0c1 \ub9e4\ub9e4\ub97c \uae08\uc9c0\ud55c\ub2e4. (\ucd08\uae30 \ub370\uc774\ud130\uc758 \uc774\uc0c1\uce58 \uc81c\uac70 \ud544\uc694)  "),(0,r.kt)("li",{parentName:"ul"},"\ubbf8\ub798 \ub370\uc774\ud130\ub97c \ubbf8\ub9ac \uac00\uc838\uc640\uc11c \ud3c9\uade0\uce58\ub97c \ub0b4\uba74 \uc548\ub418\ubbc0\ub85c expanding \ud568\uc218\ub97c \uc774\uc6a9\ud55c\ub2e4.  ")),(0,r.kt)("p",null,"2.\ubd84\ud560 \ub9e4\uc218\ub97c \ud55c\ub2e4.  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uc2dc\uadf8\ub110 \uc774\ud6c4 \uc9c4\uc785\uc2dc size\uac12\uc744 \uc774\uc6a9\ud574\uc11c \uc9c4\uc785\ud55c\ub2e4.  ")),(0,r.kt)("p",null,"3.\uac00\uc911 \ubd84\ud560 \ub9e4\uc218\ub97c \ud55c\ub2e4.  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MA12 \uac00\uc911\uce58 2"),(0,r.kt)("li",{parentName:"ul"},"MA24 \uac00\uc911\uce58 8")),(0,r.kt)("p",null,"4.\ubd84\ud560\ub9e4\uc218 Level1\uc801\uc6a9\ud55c\ub2e4.  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ucd5c\uc18c 10\ubc88\uc5d0 \ub098\ub204\uc5b4\uc11c \ub9e4\uc218  "),(0,r.kt)("li",{parentName:"ul"},"\uac01 \uc2dc\ud589\ub9c8\ub2e4 \uac00\uc911\uce58 \ub9e4\uc218\ub97c \uc9c4\ud589\ud55c\ub2e4.  ")),(0,r.kt)("h3",{id:"long-position"},"Long Position"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MA12 ZScore \ud558\uc704 1% "),(0,r.kt)("li",{parentName:"ul"},"MA12 ZScore \ud558\uc704 1% ")),(0,r.kt)("h3",{id:"short-position"},"Short Position"),(0,r.kt)("p",null,"long only  "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"stoploss 30%")),(0,r.kt)("h2",{id:"result---btcusdt-1h"},"Result - BTC/USDT, 1h"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},"\nimport numpy as np\nimport pandas as pd\nimport ccxt\nimport ta\nimport vectorbt as vbt\nimport quantstats as qs\nimport warnings\nimport time\nfrom datetime import datetime, timedelta\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\n\n# \ub370\uc774\ud130 \ud638\ucd9c \ud568\uc218\ndef getHourlyOHLCV(days=100, ticker='BTC/USDT'):\n  startSince = datetime.now() - timedelta(days)\n  dfOHLCV = pd.DataFrame(columns=['Time', 'Open', 'High', 'Low', 'Close', 'Volume'])\n  since = int(startSince.timestamp() * 1000)\n  prevSince = None\n\n  while True:\n      data = ccxt.upbit().fetch_ohlcv(ticker, '1h', since)\n      df = pd.DataFrame(data, columns=['Time', 'Open', 'High', 'Low', 'Close', 'Volume'])\n      df['Time'] = pd.to_datetime(df['Time'], unit='ms')  # ms(long) > datetime\n\n      dfOHLCV = pd.concat([dfOHLCV, df], ignore_index=True)\n      since = int(dfOHLCV['Time'].iloc[-1].timestamp() * 1000) + 1 # +1ms for no dedup\n\n      if since != None and prevSince == since:\n        break\n\n      prevSince = since\n      time.sleep(0.1)\n\n  dfOHLCV = dfOHLCV.drop_duplicates(subset=['Time']) # dedup\n  dfOHLCV = dfOHLCV.set_index('Time').resample('1H').ffill() # backfill prev data\n  return dfOHLCV\n\n# \uc774\uc0c1\uac12 \uc81c\uac70\ndef remove_outliers(series):\n    rev_range = 3  # \uc81c\uac70 \ubc94\uc704 \uc870\uc808 \ubcc0\uc218\n    level_1q, level_3q = series.quantile(0.25), series.quantile(0.75)\n    IQR = level_3q - level_1q\n    return series[(series <= level_3q + (rev_range * IQR)) & (series >= level_1q - (rev_range * IQR))]\n\n# ---- layer:data\ndfOHLCV = getHourlyOHLCV(days=100,ticker=\"LINK/KRW\")\n\n# ---- layer:indicator\ndf = dfOHLCV.copy()\ndf['RowNum'] = df.reset_index().index\ndf['MA4'] = ta.trend.SMAIndicator(df['Close'],4).sma_indicator()\ndf['MA12'] = ta.trend.SMAIndicator(df['Close'], 12).sma_indicator()\ndf['MA24'] = ta.trend.SMAIndicator(df['Close'], 24).sma_indicator()\ndf['MA72'] = ta.trend.SMAIndicator(df['Close'], 72).sma_indicator()\n\n# zscore\ndf['MA12Gap'] = df['Close'] - df['MA12']\ndf['MA12ZScore'] = (df['MA12Gap'] - df['MA12Gap'].expanding().mean()) / df['MA12Gap'].expanding().std()\ndf['MA12ZScore'] = remove_outliers(df['MA12ZScore'])\n\n\n# ---- layer:signal\n# long only\ndf['SignalMA12ZScore'] = np.select( [ df['MA12ZScore'] < df['MA12ZScore'].quantile(0.01), df['MA12ZScore'] > df['MA12ZScore'].quantile(0.99),  ],[1,0],0 )\n\n# ---- layer:position\ncond_go = [ (df['SignalMA12ZScore'] == 1) & (df['RowNum'] > 12*10), df['SignalMA12ZScore'] == -1 ]\ndf['go'] = np.select(cond_go, [1,-1], 0)\ndf['go'] = df['go'].mask(df['go'] == df['go'].shift(1), 0) # \ucd5c\ucd08\uac12\uc720\uc9c0\n\ndf['size'] = (df[['go']].expanding().sum()*10).abs() # \ubd84\ud560\ub9e4\uc218 \uc0ac\uc774\uc988\n\n# ---- layer:anomalo\nplt.figure(figsize=(25,5))\nplt.grid(True)\nplt.hist([df['MA12ZScore']],bins=300,label=['a'])\nplt.legend()\nplt.show()\n\nbenchmarkTotlaReturns = ((df['Close'].iloc[-1] - df['Close'].iloc[0]) / df['Close'].iloc[0])*100\nlastSize = df['size'][-1]\ncountGoTrue = df['go'].value_counts()[1]\ncountGoHold = df['go'].value_counts()[0]\ncountSignalMA12ZScoreTrue = df['SignalMA12ZScore'].value_counts()[1]\ncountSignalMA12ZScoreFalse = df['SignalMA12ZScore'].value_counts()[0]\n\nprint(f\"countGoTrue {countGoTrue}\")\nprint(f\"countGoHold {countGoHold}\")\nprint(f\"countSignalMA12ZScoreTrue {countSignalMA12ZScoreTrue}\")\nprint(f\"countSignalMA12ZScoreFalse {countSignalMA12ZScoreFalse}\")\nprint(f\"benchmarkTotlaReturns {benchmarkTotlaReturns}\")\nprint(f\"lastSize {lastSize}\")\n\n# layer:trading\npf = vbt.Portfolio.from_signals(\n    df['Close'],\n    entries = (df['go']==1), # long \ud3ec\uc9c0\uc158 \uc9c4\uc785\n    exits = (df['go']==-1), # long \ud3ec\uc9c0\uc158 \ud0c8\ucd9c\n    sl_stop = 0.3, # stop loss, 10% \uc190\ud574 > \uc190\uc808\n    sl_trail = True, # \ud2b8\ub808\uc77c\ub9c1 \uc2a4\ud0d1\n    fees = 0.0006, # \uac70\ub798\uc218\uc218\ub8cc ( bybit ) \uc8fc\ubb38\uc2dc post-only\n    # allow_partial = True,\n    size_type = 1, # Value 1 | Percent 2 | TargetValue 4\n    size = df['size'],\n    log=True,\n    freq='1H',\n    accumulate = True # \ubd84\ud560 \ub9e4\uc218 \uac00\ub2a5\ud558\uac8c, \uae30\ubcf8\uac12=False > \ub9e4\uc218 \ud6c4 Hold\n    # post-only True -> \ubb34\uc870\uac74 \uc9c0\uc815\ud55c \uac00\uaca9\uc5d0\ub9cc \uccb4\uacb0 / \uc218\uc218\ub8cc \ub0ae\uac8c \uc9c0\ubd88 \uac00\ub2a5 / \uc2e4\uc218\ud574\uc11c \uc190\ud574\ubcf4\ub294 \uacbd\uc6b0\uac00 \uc5c6\ub2e4. (\uc2dc\uc7a5\uac00 \uccb4\uacb0 \ub418\ub294 \ucf00\uc774\uc2a4)\n    # tp_stop = 0.09, # take profit, 9% \uc774\uc775 > \uc775\uc808\n    # short_entries = (df['go']==-1), # short \ud3ec\uc9c0\uc158 \uc9c4\uc785\n    # short_exits = (df['go']==1) # short \ud3ec\uc9c0\uc158 \ud0c8\ucd9c\n)\nprint(pf.stats())\n\n# layer:visualize\npf.plot().show()\n\n\n# layer:report\npf.qs.plot_snapshot()\nqs.plots.snapshot(pf.benchmark_returns())\n\n# layer:notice\nbuyNotice = (df.tail(4)['go'] == 1).any()\n\n\n\n")),(0,r.kt)("h3",{id:"stats"},"stats"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Start                         2023-11-25 08:00:00\nEnd                           2024-03-04 07:00:00\nPeriod                          100 days 00:00:00\nStart Value                                 100.0\nEnd Value                              168.937901\nTotal Return [%]                        68.937901\nBenchmark Return [%]                    68.358269\nMax Gross Exposure [%]                      100.0\nTotal Fees Paid                          0.322645\nMax Drawdown [%]                        19.575762\nMax Drawdown Duration            30 days 12:00:00\nTotal Trades                                    3\nTotal Closed Trades                             2\nTotal Open Trades                               1\nOpen Trade PnL                          64.883777\nWin Rate [%]                                 50.0\nBest Trade [%]                          14.855785\nWorst Trade [%]                         -9.403154\nAvg Winning Trade [%]                   14.855785\nAvg Losing Trade [%]                    -9.403154\nAvg Winning Trade Duration       47 days 14:00:00\nAvg Losing Trade Duration        10 days 12:00:00\nProfit Factor                            1.375634\nExpectancy                               2.027062\nSharpe Ratio                             2.920345\nCalmar Ratio                            29.524251\nOmega Ratio                               1.09474\nSortino Ratio                            4.242156\n\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(66653).Z,width:"664",height:"317"})),(0,r.kt)("h2",{id:"result---linkkrw-1h---tc2"},"Result - LINK/KRW, 1h - TC2"),(0,r.kt)("p",null,"\ub9e4\ub3c4 : -10% drawdown \uc190\uc2e4"),(0,r.kt)("h3",{id:"stats-1"},"stats"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"benchmark total return 43.658413340070744\nStart                         2023-11-25 08:00:00\nEnd                           2024-03-04 07:00:00\nPeriod                          100 days 00:00:00\nStart Value                                 100.0\nEnd Value                              134.324584\nTotal Return [%]                        34.324584\nBenchmark Return [%]                    43.658413\nMax Gross Exposure [%]                      100.0\nTotal Fees Paid                          0.888398\nMax Drawdown [%]                        24.620326\nMax Drawdown Duration            54 days 06:00:00\nTotal Trades                                    8\nTotal Closed Trades                             7\nTotal Open Trades                               1\nOpen Trade PnL                          10.461915\nWin Rate [%]                            42.857143\nBest Trade [%]                          25.874756\nWorst Trade [%]                         -9.663215\nAvg Winning Trade [%]                   17.630381\nAvg Losing Trade [%]                    -6.444443\nAvg Winning Trade Duration       13 days 10:20:00\nAvg Losing Trade Duration         7 days 15:15:00\nProfit Factor                            1.949065\nExpectancy                               3.408953\nSharpe Ratio                             1.879882\nCalmar Ratio                             7.863738\nOmega Ratio                              1.064586\nSortino Ratio                            2.685104\ndtype: object\n")),(0,r.kt)("h2",{id:"result---linkkrw-1h---tc3"},"Result - LINK/KRW, 1h - TC3"),(0,r.kt)("p",null,"\ub9e4\ub3c4 : -20% drawdown \uc190\uc2e4"),(0,r.kt)("h3",{id:"stats-2"},"stats"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Start                         2023-11-25 08:00:00\nEnd                           2024-03-04 07:00:00\nPeriod                          100 days 00:00:00\nStart Value                                 100.0\nEnd Value                              129.473206\nTotal Return [%]                        29.473206\nBenchmark Return [%]                    43.759474\nMax Gross Exposure [%]                      100.0\nTotal Fees Paid                          0.265968\nMax Drawdown [%]                        30.675143\nMax Drawdown Duration            55 days 07:00:00\nTotal Trades                                    3\nTotal Closed Trades                             2\nTotal Open Trades                               1\nOpen Trade PnL                          48.190837\nWin Rate [%]                                  0.0\nBest Trade [%]                          -9.617927\nWorst Trade [%]                        -10.079824\nAvg Winning Trade [%]                         NaN\nAvg Losing Trade [%]                    -9.848875\nAvg Winning Trade Duration                    NaT\nAvg Losing Trade Duration        16 days 20:00:00\nProfit Factor                                 0.0\nExpectancy                              -9.358816\nSharpe Ratio                             1.638765\nCalmar Ratio                             5.108964\nOmega Ratio                              1.053357\nSortino Ratio                            2.355005\n")),(0,r.kt)("h2",{id:"result---linkkrw-1h---tc3-1"},"Result - LINK/KRW, 1h - TC3"),(0,r.kt)("p",null,"\ub9e4\ub3c4 : -10% drawdown \uc190\uc2e4"),(0,r.kt)("h3",{id:"stats-3"},"stats"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"")),(0,r.kt)("h2",{id:"result---linkkrw-1h---tc4"},"Result - LINK/KRW, 1h - TC4"),(0,r.kt)("p",null,"\ub9e4\ub3c4 : -30% drawdown \uc190\uc2e4\n\ub9e4\uc9d1 : df","['MA12ZScore']"," < df","['MA12ZScore']",".quantile(0.01)"),(0,r.kt)("h3",{id:"stats-4"},"stats"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Start                         2023-11-25 09:00:00\nEnd                           2024-03-04 08:00:00\nPeriod                          100 days 00:00:00\nStart Value                                 100.0\nEnd Value                               135.95403\nTotal Return [%]                         35.95403\nBenchmark Return [%]                    43.574297\nMax Gross Exposure [%]                      100.0\nTotal Fees Paid                          0.059964\nMax Drawdown [%]                        25.721672\nMax Drawdown Duration            35 days 13:00:00\nTotal Trades                                    1\nTotal Closed Trades                             0\nTotal Open Trades                               1\nOpen Trade PnL                           35.95403\nWin Rate [%]                                  NaN\nBest Trade [%]                                NaN\nWorst Trade [%]                               NaN\nAvg Winning Trade [%]                         NaN\nAvg Losing Trade [%]                          NaN\nAvg Winning Trade Duration                    NaT\nAvg Losing Trade Duration                     NaT\nProfit Factor                                 NaN\nExpectancy                                    NaN\nSharpe Ratio                             1.880543\nCalmar Ratio                              8.04062\nOmega Ratio                              1.060568\nSortino Ratio                             2.71913\ndtype: object\n")),(0,r.kt)("h2",{id:"result---linkkrw-1h---tc5"},"Result - LINK/KRW, 1h - TC5"),(0,r.kt)("p",null,"\ub9e4\ub3c4 : -30% drawdown \uc190\uc2e4",(0,r.kt)("br",{parentName:"p"}),"\n","\ub9e4\uc9d1 : df","['MA12ZScore']"," < df","['MA12ZScore']",".quantile(0.01) , 2",(0,r.kt)("br",{parentName:"p"}),"\n","\ub9e4\uc9d1 : df","['MA24ZScore']"," < df","['MA24ZScore']",".quantile(0.01) , 8  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},"\n# ---- layer:indicator\ndf = dfOHLCV.copy()\ndf['RowNum'] = df.reset_index().index\ndf['MA4'] = ta.trend.SMAIndicator(df['Close'],4).sma_indicator()\ndf['MA12'] = ta.trend.SMAIndicator(df['Close'], 12).sma_indicator()\ndf['MA24'] = ta.trend.SMAIndicator(df['Close'], 24).sma_indicator()\ndf['MA72'] = ta.trend.SMAIndicator(df['Close'], 72).sma_indicator()\n\n# zscore\ndf['MA12Gap'] = df['Close'] - df['MA12']\ndf['MA12ZScore'] = (df['MA12Gap'] - df['MA12Gap'].expanding().mean()) / df['MA12Gap'].expanding().std()\ndf['MA12ZScore'] = remove_outliers(df['MA12ZScore'])\n\ndf['MA24Gap'] = df['Close'] - df['MA24']\ndf['MA24ZScore'] = (df['MA24Gap'] - df['MA24Gap'].expanding().mean()) / df['MA24Gap'].expanding().std()\ndf['MA24ZScore'] = remove_outliers(df['MA24ZScore'])\n\n# ---- layer:signal\n# long only\ndf['SignalMA12ZScore'] = np.select( [ df['MA12ZScore'] < df['MA12ZScore'].quantile(0.01), df['MA12ZScore'] > df['MA12ZScore'].quantile(0.99),  ],[1,0],0 )\ndf['SignalMA24ZScore'] = np.select( [ df['MA24ZScore'] < df['MA24ZScore'].quantile(0.01), df['MA24ZScore'] > df['MA24ZScore'].quantile(0.99),  ],[1,0],0 )\n\n# ---- layer:position\ncond_go = [ (df['RowNum'] > 12*10) & (df['SignalMA12ZScore'] == 1) , df['SignalMA12ZScore'] == -1 ]\ndf['go1'] = np.select(cond_go, [1,-1], 0)\ndf['go1'] = df['go1'].mask(df['go1'] == df['go1'].shift(1), 0) # \ucd5c\ucd08\uac12\uc720\uc9c0\n\ncond_go = [ (df['RowNum'] > 12*10) & (df['SignalMA24ZScore'] == 1) , df['SignalMA12ZScore'] == -1 ]\ndf['go2'] = np.select(cond_go, [1,-1], 0)\ndf['go2'] = df['go2'].mask(df['go2'] == df['go2'].shift(1), 0) # \ucd5c\ucd08\uac12\uc720\uc9c0\n\nresult_df = pd.concat([(df[['go1']].expanding().sum()*2).abs(), (df[['go2']].expanding().sum()*8).abs()], axis=1 )\ndf['go'] = df['go1'] & df['go2']\ndf['size'] = result_df.sum(axis=1)\n\n# df['size'] = (df[['go1']].expanding().sum()*1).abs() + (df[['go2']].expanding().sum()*5).abs() # \ubd84\ud560\ub9e4\uc218 \uc0ac\uc774\uc988\n\n# ---- layer:anomalo\nplt.figure(figsize=(25,5))\nplt.grid(True)\nplt.hist([df['MA12ZScore']],bins=300,label=['a'])\nplt.legend()\nplt.show()\n\nbenchmarkTotlaReturns = ((df['Close'].iloc[-1] - df['Close'].iloc[0]) / df['Close'].iloc[0])*100\nlastSize = df['size'][-1]\ncountGoTrue = df['go'].value_counts()[1]\ncountGoHold = df['go'].value_counts()[0]\ncountSignalMA12ZScoreTrue = df['SignalMA12ZScore'].value_counts()[1]\ncountSignalMA12ZScoreFalse = df['SignalMA12ZScore'].value_counts()[0]\n\nprint(f\"countGoTrue {countGoTrue}\")\nprint(f\"countGoHold {countGoHold}\")\nprint(f\"countSignalMA12ZScoreTrue {countSignalMA12ZScoreTrue}\")\nprint(f\"countSignalMA12ZScoreFalse {countSignalMA12ZScoreFalse}\")\nprint(f\"benchmarkTotlaReturns {benchmarkTotlaReturns}\")\nprint(f\"lastSize {lastSize}\")\n\n# layer:trading\npf = vbt.Portfolio.from_signals(\n    df['Close'],\n    entries = (df['go']>=1), # long \ud3ec\uc9c0\uc158 \uc9c4\uc785\n    exits = (df['go']<=-1), # long \ud3ec\uc9c0\uc158 \ud0c8\ucd9c\n    sl_stop = 0.3, # stop loss, 10% \uc190\ud574 > \uc190\uc808\n    sl_trail = True, # \ud2b8\ub808\uc77c\ub9c1 \uc2a4\ud0d1\n    fees = 0.0006, # \uac70\ub798\uc218\uc218\ub8cc ( bybit ) \uc8fc\ubb38\uc2dc post-only\n    # allow_partial = True,\n    size_type = 1, # Value 1 | Percent 2 | TargetValue 4\n    size = df['size'],\n    log=True,\n    freq='1H',\n    accumulate = True # \ubd84\ud560 \ub9e4\uc218 \uac00\ub2a5\ud558\uac8c, \uae30\ubcf8\uac12=False > \ub9e4\uc218 \ud6c4 Hold\n    # post-only True -> \ubb34\uc870\uac74 \uc9c0\uc815\ud55c \uac00\uaca9\uc5d0\ub9cc \uccb4\uacb0 / \uc218\uc218\ub8cc \ub0ae\uac8c \uc9c0\ubd88 \uac00\ub2a5 / \uc2e4\uc218\ud574\uc11c \uc190\ud574\ubcf4\ub294 \uacbd\uc6b0\uac00 \uc5c6\ub2e4. (\uc2dc\uc7a5\uac00 \uccb4\uacb0 \ub418\ub294 \ucf00\uc774\uc2a4)\n    # tp_stop = 0.09, # take profit, 9% \uc774\uc775 > \uc775\uc808\n    # short_entries = (df['go']==-1), # short \ud3ec\uc9c0\uc158 \uc9c4\uc785\n    # short_exits = (df['go']==1) # short \ud3ec\uc9c0\uc158 \ud0c8\ucd9c\n)\nprint(pf.stats())\n\n# layer:visualize\npf.plot().show()\n\n\n# layer:report\npf.qs.plot_snapshot()\nqs.plots.snapshot(pf.benchmark_returns())\n\n# layer:notice\nbuyNotice = (df.tail(4)['go'] == 1).any()\n")),(0,r.kt)("h3",{id:"stats-5"},"stats"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:t(5951).Z,width:"668",height:"295"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"lastSize 108.0\nStart                         2023-11-25 09:00:00\nEnd                           2024-03-04 08:00:00\nPeriod                          100 days 00:00:00\nStart Value                                 100.0\nEnd Value                              144.534144\nTotal Return [%]                        44.534144\nBenchmark Return [%]                    43.574297\nMax Gross Exposure [%]                      100.0\nTotal Fees Paid                          0.059964\nMax Drawdown [%]                        17.492328\nMax Drawdown Duration            17 days 01:00:00\nTotal Trades                                    1\nTotal Closed Trades                             0\nTotal Open Trades                               1\nOpen Trade PnL                          44.534144\nWin Rate [%]                                  NaN\nBest Trade [%]                                NaN\nWorst Trade [%]                               NaN\nAvg Winning Trade [%]                         NaN\nAvg Losing Trade [%]                          NaN\nAvg Winning Trade Duration                    NaT\nAvg Losing Trade Duration                     NaT\nProfit Factor                                 NaN\nExpectancy                                    NaN\nSharpe Ratio                             2.563104\nCalmar Ratio                            16.213507\nOmega Ratio                              1.091704\nSortino Ratio                            3.855461\n")))}p.isMDXComponent=!0},66653:(n,e,t)=>{t.d(e,{Z:()=>a});const a=t.p+"assets/images/image-7-3d038b1f4e746e407fb1ace448bb50e3.png"},5951:(n,e,t)=>{t.d(e,{Z:()=>a});const a=t.p+"assets/images/image-8-6a146010bd9bee18382638dd53d07486.png"},88781:(n,e,t)=>{t.d(e,{Z:()=>a});const a=t.p+"assets/images/image-9-589c34e5e8e2ff5285332934620c192f.png"}}]);