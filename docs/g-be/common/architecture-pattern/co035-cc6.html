<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-g-be/common/architecture-pattern/co035-cc6" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns | DoDo(도도)의 개발 블로그</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dosimpact.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://dosimpact.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co035-cc6"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="frontend, 취업가이드, 개발자 취업, 포트폴리오, 코테 공부, 개발자 현실, 프론트 개발자"><meta data-rh="true" name="google-site-verification" content="Ov_hk6LqaaE5KiwXnqF2gTKwPxBE3qG5Zr3o5UWZXc8"><meta data-rh="true" name="google-adsense-account" content="ca-pub-7124760459431977"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns | DoDo(도도)의 개발 블로그"><meta data-rh="true" name="description" content="- Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns"><meta data-rh="true" property="og:description" content="- Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co035-cc6"><link data-rh="true" rel="alternate" href="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co035-cc6" hreflang="en"><link data-rh="true" rel="alternate" href="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co035-cc6" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ME6STB8MA7-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DoDo(도도)의 개발 블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DoDo(도도)의 개발 블로그 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WKPFKPLJJC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WKPFKPLJJC",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DoDo(도도)의 개발 블로그" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.1062fdd8.css">
<link rel="preload" href="/assets/js/runtime~main.0d44839d.js" as="script">
<link rel="preload" href="/assets/js/main.15407641.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">DoDo</b></a><a class="navbar__item navbar__link" href="/docs/category/1common">👒Front End</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/0common">🛰️Backend End</a><a class="navbar__item navbar__link" href="/docs/category/common">🚧DevOps</a><a class="navbar__item navbar__link" href="/docs/category/1python">💎DA</a><a class="navbar__item navbar__link" href="/docs/category/1uxui">💻Hard Skill</a><a class="navbar__item navbar__link" href="/docs/category/1아웃풋">🔅Soft Skill</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dosimpact" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/0common">0.Common</a><button aria-label="Toggle the collapsible sidebar category &#x27;0.Common&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/cloud-sw-아키텍처">Cloud SW 아키텍처</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud SW 아키텍처&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co030-cc1">Cloud SW 아키텍처 패턴:소개</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co031-cc2">Cloud SW 아키텍처 패턴:Scalability Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co032-cc3">Cloud SW 아키텍처 패턴:Performance Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co033-cc4">Cloud SW 아키텍처 패턴:Extensibility Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/g-be/common/architecture-pattern/co035-cc6">Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co036-cc7">Cloud SW 아키텍처 패턴:Deployment and Production Testing Patterns</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/auth">Auth</a><button aria-label="Toggle the collapsible sidebar category &#x27;Auth&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/co001-sd1">[시스템디자인&amp;인터뷰] 1.확장 가능한 시스템 설계</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/1nestjs">1.NestJS</a><button aria-label="Toggle the collapsible sidebar category &#x27;1.NestJS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/1nodejs">1.Node.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;1.Node.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2sql">2.Sql</a><button aria-label="Toggle the collapsible sidebar category &#x27;2.Sql&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/3kafka">3.Kafka</a><button aria-label="Toggle the collapsible sidebar category &#x27;3.Kafka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/4elasticsearch">4.ElasticSearch</a><button aria-label="Toggle the collapsible sidebar category &#x27;4.ElasticSearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/0common"><span itemprop="name">0.Common</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/cloud-sw-아키텍처"><span itemprop="name">Cloud SW 아키텍처</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns</h1><ul><li><a href="#cloud-sw-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%ED%8C%A8%ED%84%B4reliability-error-handling-recovery-patterns">Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns</a><ul><li><a href="#reliability-error-handling-recovery-patterns">Reliability, Error Handling, Recovery Patterns</a></li><li><a href="#throttling-and-rate-limiting-pattern">Throttling and Rate Limiting Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C-%EC%A0%95%EC%9D%98---overconsumption">문제 정의 - Overconsumption</a></li><li><a href="#%ED%95%B4%EA%B2%B0">해결</a></li><li><a href="#server-side-throttling">Server Side throttling</a></li><li><a href="#client-side-throttling">Client Side throttling</a><ul><li><a href="#%EC%97%AC%EB%9F%AC%EA%B0%80%EC%A7%80-throttling-%EC%A0%84%EB%9E%B5%EB%93%A4%EC%9D%84-%EA%B5%AC%EC%82%AC%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8B%A4">여러가지 throttling 전략들을 구사할 수 있다.</a></li><li><a href="#%EC%97%AC%EB%9F%AC%EA%B0%80%EC%A7%80-global-rate-limit-%EC%A0%95%EC%B1%85">여러가지 Global Rate Limit 정책</a></li></ul></li></ul></li><li><a href="#retry-pattern">Retry Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C-%EC%A0%95%EC%9D%98">문제 정의</a></li><li><a href="#%ED%95%B4%EA%B2%B0-1">해결</a></li><li><a href="#%EC%95%A0%EB%9F%AC-%EC%B9%B4%ED%85%8C%EA%B3%A0%EB%A6%AC%ED%99%94---user-error-vs-system-error">애러 카테고리화 - User Error vs System Error</a></li><li><a href="#%EA%B3%A0%EB%A0%A4%EC%A0%90">고려점</a></li></ul></li><li><a href="#circit-breaker-pattern">Circit Breaker Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C%EC%A0%90">문제점</a></li><li><a href="#%ED%95%B4%EA%B2%B0%EB%B2%95">해결법</a></li><li><a href="#half-open">half-open</a></li><li><a href="#%EA%B3%A0%EB%A0%A4%EC%A0%90-1">고려점</a></li></ul></li><li><a href="#dead-letter-queue-pattern-dlq">Dead Letter Queue Pattern (DLQ)</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C%EC%A0%90-1">문제점</a></li><li><a href="#%ED%95%B4%EA%B2%B0-2">해결</a></li><li><a href="#%EC%82%AC%EB%A1%80">사례</a></li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reliability-error-handling-recovery-patterns">Reliability, Error Handling, Recovery Patterns<a href="#reliability-error-handling-recovery-patterns" class="hash-link" aria-label="Direct link to Reliability, Error Handling, Recovery Patterns" title="Direct link to Reliability, Error Handling, Recovery Patterns">​</a></h2><hr><p>4.신뢰성, 오류 처리 및 복구 아키텍처 패턴<br>
<!-- -->Reliability, Error Handling and Recovery Software Architecture Patterns        </p><p>왜 알아야 하는가 ? </p><ul><li>악의적인 클라이언트의 요청으로부터 서버를 보호하는 전략  </li><li>요청 실패에 대한 적절한 조치 그리고 리커버리 전략    </li><li>메시지 브로커의 처리 실패한 메시지에 대한 감지 및 처리 전략     </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="throttling-and-rate-limiting-pattern">Throttling and Rate Limiting Pattern<a href="#throttling-and-rate-limiting-pattern" class="hash-link" aria-label="Direct link to Throttling and Rate Limiting Pattern" title="Direct link to Throttling and Rate Limiting Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제-정의---overconsumption">문제 정의 - Overconsumption<a href="#문제-정의---overconsumption" class="hash-link" aria-label="Direct link to 문제 정의 - Overconsumption" title="Direct link to 문제 정의 - Overconsumption">​</a></h3><p>클라이언트에서 비정상적으로 많은 요청이 발생하여 서버가 모두 대응하고 있다면 ? </p><ul><li>Overconsumption 이슈 발생   </li><li>서버의 리소스 한계로 서버가 죽을수 있다. 이는 서비스 수준 협약 SLA 위반  </li><li>혹은 오토 스케일링으로 서버 비용 증가  </li></ul><p>악의적인 목적이 아니라 데이터 분석을 위해서 다량의 API를 호출하는 경우도 있다.  </p><ul><li>정시마다 API요청이 피크치는 경우  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결">해결<a href="#해결" class="hash-link" aria-label="Direct link to 해결" title="Direct link to 해결">​</a></h3><p>해결방법은 적절한 Throttling and Rate Limiting 도입  </p><p>Throttling : 많은 요청이 들어오면 우선 요청을 대기큐에 넣고, 차근차근 서버에 처리하는 로직  </p><ul><li>요청을 대시기키는 Queue 로 구현 ( Redis, Kafka )</li></ul><p>Rate Limiting : 많은 요청이 들어오면, Limit 이상의 요청을 드랍하는 로직  </p><ul><li>Redis, In-Memory 등으로 구현    </li><li>예) QPS 30 으로 API 제한  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="server-side-throttling">Server Side throttling<a href="#server-side-throttling" class="hash-link" aria-label="Direct link to Server Side throttling" title="Direct link to Server Side throttling">​</a></h3><p>시스템의 과소비를 막는 방법   </p><ul><li>제공된 할당량이 이상으로 처리하지 않도록 제한  </li><li>예) 분당 1G의 송수신 이상은 처리하지 않는다.  </li><li>이는 서버단위의 제약사항으로 구현  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="client-side-throttling">Client Side throttling<a href="#client-side-throttling" class="hash-link" aria-label="Direct link to Client Side throttling" title="Direct link to Client Side throttling">​</a></h3><p>클라이언트측의 제한을 두는 방법.   </p><ul><li>클라이언트별로 차등을 두어 구현한다.  </li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="여러가지-throttling-전략들을-구사할-수-있다">여러가지 throttling 전략들을 구사할 수 있다.<a href="#여러가지-throttling-전략들을-구사할-수-있다" class="hash-link" aria-label="Direct link to 여러가지 throttling 전략들을 구사할 수 있다." title="Direct link to 여러가지 throttling 전략들을 구사할 수 있다.">​</a></h4><p><img loading="lazy" src="/assets/images/co47-7275c7ca0440b41ee9330c78c460742d.png" width="1376" height="890" class="img_ev3q"></p><p>1.Dropping Reqeust : 429 Too Many Reqeust 요청으로 응답한다.   </p><ul><li>예) 주가 데이터를 요청하는 API를 너무많이 요청하는 클라이언트에게, 429 응답코드를 보내준다.  </li></ul><p>2.Request Queue : 요청이 들어오면 대기열에 들어간다.  </p><ul><li>추후 처리를 해준다.     </li></ul><p>1+2. 모든 요청들을 큐에다 담아서 처리를하면서, 리미트값 이상의 요청은 드랍  </p><p>3.Reduce Quality / Limit Bandwith  </p><ul><li>저화질로 영상 콘텐츠 및 오디오 제공   </li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="여러가지-global-rate-limit-정책">여러가지 Global Rate Limit 정책<a href="#여러가지-global-rate-limit-정책" class="hash-link" aria-label="Direct link to 여러가지 Global Rate Limit 정책" title="Direct link to 여러가지 Global Rate Limit 정책">​</a></h4><ul><li>비즈니스 요구사항에 따라서 구현  </li><li>특정 IP에 대해서 Rate Limiter를 거는 방법 </li><li>일부 API 혹은 UserId별로 Rate Limiter를 거는 방법   </li><li>요금제에 따라서 Rate Limiter를 거는 방법   </li><li>서비스 별로 Rate Limiter를 거는 방법 (채권,주식,ETF 등)  </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="retry-pattern">Retry Pattern<a href="#retry-pattern" class="hash-link" aria-label="Direct link to Retry Pattern" title="Direct link to Retry Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제-정의">문제 정의<a href="#문제-정의" class="hash-link" aria-label="Direct link to 문제 정의" title="Direct link to 문제 정의">​</a></h3><p>외부 리소스의 요청은 항상 다음 케이스를 생각해야 한다.  </p><ul><li>Success   </li><li>Fail with ErrorMsg, Fail with no ErrorMsg, Timeout, Delay  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결-1">해결<a href="#해결-1" class="hash-link" aria-label="Direct link to 해결" title="Direct link to 해결">​</a></h3><p>Retry 로직을 구현하면 된다.  </p><ul><li>일시적 장애상황이므로 수초, 수분내에 해결될 비교적 낙관적인 상황이다.    </li><li>비교적 간단하지만 몇가지 고려해야 할 사항들이 있다.   </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="애러-카테고리화---user-error-vs-system-error">애러 카테고리화 - User Error vs System Error<a href="#애러-카테고리화---user-error-vs-system-error" class="hash-link" aria-label="Direct link to 애러 카테고리화 - User Error vs System Error" title="Direct link to 애러 카테고리화 - User Error vs System Error">​</a></h3><p>사용자 애러인가 ? 시스템 애러인가 ? 구분</p><p>사용자 애러  </p><ul><li>403 Not Authorized 애러는 사용자의 권한이 없다는 것이다.  </li><li>이는 사용자가 발생시킨 정상적인 오류이므로, 적절한 피드백이 제공     </li></ul><p>시스템 애러</p><ul><li>500 Internal Server Error는 시스템 내부의 핸들링 못한 오류로 발생    </li><li>사용자에게 오류정보는 드러내면 안된다.   </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="고려점">고려점<a href="#고려점" class="hash-link" aria-label="Direct link to 고려점" title="Direct link to 고려점">​</a></h3><p>1.어떤 오류일때 재시도할지 선택  </p><ul><li>503 Service Unavailable 애러라면 성공할때 까지 몇 번 더 요청할 수 있다.  </li><li>LB를 통해 정상적인 서버에 도달할 수 있음  </li></ul><p><img loading="lazy" src="/assets/images/co48-15417179594e75febda4c3c64faf3086.png" width="1580" height="1074" class="img_ev3q"></p><p>2.지연 및 Backoff 전략 </p><ul><li>retry storm으로 전체 서비스 장애로 퍼지는 경우가 있다.  </li><li>예) 모종의 이유로 서버 10대 중 2대가 장애가 발생한 경우    </li><li>retry 횟수가 증가하면서 증가한 트래픽이 나머지 8대 서버에게 장애를 일으키는 경우  </li><li>재시도 사이에는 적절한 딜레이가 필요하다.  </li></ul><p>Strategies:
<img loading="lazy" src="/assets/images/co49-d0aca40b6e67c62f2f389afe5a445968.png" width="1876" height="876" class="img_ev3q">
<img loading="lazy" src="/assets/images/co50-b2e1877bdfcbef5da6f17ef8208e1a2a.png" width="1906" height="862" class="img_ev3q">
<img loading="lazy" src="/assets/images/co51-a41a161c03c0b3c9f87b499abaee37fe.png" width="1898" height="850" class="img_ev3q"></p><p>• Fixed Delay<br>
<!-- -->• Incremental Delay<br>
<!-- -->• Exponential Backoff  </p><p>3.랜덤화 및 지터 Jitter 추가  </p><ul><li>모든 서버가 3초후 retry를 동시다발적으로 요청. 이는 장애로 번질 수 있다.    </li><li>Jitter라는 약간의 랜덤화 변수를 추가할 수 있다.   </li></ul><p><img loading="lazy" src="/assets/images/co52-6330b576d76e4d02d9e03ba84155dc89.png" width="1806" height="846" class="img_ev3q">
<img loading="lazy" src="/assets/images/co53-a1aa28d02a5d97c791ea35ad21681a7d.png" width="1854" height="880" class="img_ev3q"></p><p>4.재시도 횟수와 시간  </p><ul><li>예) 5분간 5xx애러가 200개가 넘으면 장애 상황이다.   </li><li>클라이언트는 더이상 요청을 하지 않는다.  </li><li>관련 부서에 애러를 알려야 한다. on-call</li></ul><p>5.재시도 작업의 멱등성</p><ul><li>결제같은 경우, 결제 요청을 서버에게 보냈는데 응답이 안왔다.  </li><li>1.결제 서버가 실제 처리하고 있고, 응답만 못해준 경우  </li><li>2.결제 서버가 메시지 자체를 못받은 경우  </li><li>이런 경우 다시 retry 하는데, 중복결제가 발생하면 안된다.   </li></ul><p>6.retry 로직실행 위치</p><ul><li>6.1 라이브러리 공통 모듈화 </li><li>6.2 <strong>ambassador sidecar 패턴</strong>을 이용  </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="circit-breaker-pattern">Circit Breaker Pattern<a href="#circit-breaker-pattern" class="hash-link" aria-label="Direct link to Circit Breaker Pattern" title="Direct link to Circit Breaker Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제점">문제점<a href="#문제점" class="hash-link" aria-label="Direct link to 문제점" title="Direct link to 문제점">​</a></h3><p>Retry 패턴은 단기적 오류가 발생한 케이스</p><ul><li>타임아웃 발생, 서버 crash로 재시작 중, 네트워크 이슈  </li><li>낙관적인 애러 처리로 Retry로 해결가능한 경우  </li></ul><p>하지만 외부 서버가 장기적 오류인 케이스가 있다.   </p><ul><li>긴 시간동안, 일시적이지 않은, 회복 불가능한 경우  </li><li>비관적인 경우로 외부 서버와 통신을 일시적으로 끊는다. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결법">해결법<a href="#해결법" class="hash-link" aria-label="Direct link to 해결법" title="Direct link to 해결법">​</a></h3><p><img loading="lazy" src="/assets/images/co54-0ed7acd56dc0d6771ccbfb695b70a684.png" width="1430" height="860" class="img_ev3q">
서킷 브레이커 패턴으로 해결한다.  </p><ul><li>&quot;회로의 차단&quot; 의미이다. 비유하자면 두꺼비집을 내린다. 혹은 퓨즈     </li><li>애러 비율이 높아지는 순간, 더이상 외부 서버에 요청을 보내지 않기 위해 회로를 Open 한다.  </li><li>( 메인 서버를 보호, 장애를 시스템 전체로 퍼지지 않도록 함 )  </li></ul><p>예)</p><ul><li>위 사진은 온라인 데이팅 서비스이다.  </li><li>Image Service는 사용자의 얼굴사진이 있다.  </li><li>모종의 이유로 해당 서비스가 다운되었고, 이는 긴 시간동안 회복이 어렵다고 판단. </li><li>서킷브레이커 발동 &gt; 더이상 Image Service에 요청을 보내지 않는다.  </li><li>Main 서버의 일부 기능이 다운 되더라도, 더 큰 장애로 퍼지지 않도록 한다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="half-open">half-open<a href="#half-open" class="hash-link" aria-label="Direct link to half-open" title="Direct link to half-open">​</a></h3><p><img loading="lazy" src="/assets/images/co55-1f0762bedd2a899bc842c47025d1d3d5.png" width="1818" height="1026" class="img_ev3q"></p><ul><li>평생 회로를 열어두지는 않는다.  </li><li>일정 시간이 흐른다면, 약간의 요청을 보내는 Half-Open 상태가 있다.  </li><li>여기서 많은 오류가 발생하면 다시 Open 상태로 전이되고</li><li>그렇지 않다면 Closed 상태로 전이 된다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="고려점-1">고려점<a href="#고려점-1" class="hash-link" aria-label="Direct link to 고려점" title="Direct link to 고려점">​</a></h3><p><img loading="lazy" src="/assets/images/co56-d532afa7f090212d1c3741dce5985d92.png" width="1342" height="932" class="img_ev3q"></p><p>1.서킷브레이커로 처리하지 못한 요청에 대한 후처리</p><ul><li>예) 이커머스 서비스의 경우 ( 재고, 결제, 배송 서비스 3개 있다고 가정 )    </li><li>사용자의 주문으로 재고 감소, 결제까지 발생되었다. 하지만 배송서비스까지는 전달 되지 않음   </li><li>그러면 배송서비스 전달 못한 부분은 로그를 남겨서 추후 처리하도록 한다.   </li><li>( 비즈니스 요구사항에 따라서 saga 패턴도 적용 가능 )  </li></ul><p>2.서킷브레이커로 실패에 대한 처리</p><p>2.1 fail silently</p><ul><li>데이팅 서비스에서 서킷브레이커로 사용자 이미지를 못 받는 경우  </li><li>기본 이미지로 대신할 수 있다.<br><img loading="lazy" src="/assets/images/co57-3616a5c41c753f433b2f7008be86fa2c.png" width="1498" height="892" class="img_ev3q"></li></ul><p>2.2 best effort </p><ul><li>데이팅 서비스에서 서킷브레이커로 사용자 이미지를 못받는 경우  </li><li>최신 이미지는 아니더라도, 캐시된 데이터의 이미지로 대신할 수 있다.  </li></ul><p><img loading="lazy" src="/assets/images/co58-a8a8f908fa2fb73bf6c087b378c29426.png" width="1314" height="938" class="img_ev3q"></p><p>3.각 서비스마다 서킷브레이커를 두는 것  </p><ul><li>서비스 하나가 다운되어서, 더 이상의 진행을 막지 않도록 처리해 두는 것  </li></ul><p>4.Half-Open 상태에서는 health-check API를 전송하는 것</p><ul><li>핑 체크로도 서킷을 닫을 수 있다. 리소스를 절약할 수 있다.    </li></ul><p>5.서킷브레이커를 어디에 구현할지?</p><ul><li>5.1 in server ( 각 언어의 라이브러리로 )  </li><li>5.2 ambassador sidecar  </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dead-letter-queue-pattern-dlq">Dead Letter Queue Pattern (DLQ)<a href="#dead-letter-queue-pattern-dlq" class="hash-link" aria-label="Direct link to Dead Letter Queue Pattern (DLQ)" title="Direct link to Dead Letter Queue Pattern (DLQ)">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제점-1">문제점<a href="#문제점-1" class="hash-link" aria-label="Direct link to 문제점" title="Direct link to 문제점">​</a></h3><p>카프카 같은 메시지 브로커를 이용한, 이벤트 드리븐 아키텍처는 많은 이점이 있음  </p><ul><li>1.서버간의 디커플링 ( 프로듀서, 컨슈머 ) </li><li>2.스케일 확장성 좋음  </li><li>3.비동기적 통신 및 처리 가능  </li></ul><p>하지만 애러 처리 역시 까다롭다.   </p><ul><li>잘못된 토픽을 소비하는 경우  </li><li>퍼블리싱 대상의 토픽이 없는 경우  </li><li>용량이 다 차서 메시지를 못 받는 경우  </li></ul><p><img loading="lazy" src="/assets/images/co59-5c7c9ddc4c6ad6a6f92c6a468529490d.png" width="1794" height="910" class="img_ev3q"></p><p>예) 주문 처리 서비스에서 큐의 특정 메시지를 읽을 때  </p><ul><li>계속해서 데이터 파싱 문제가 발생 하는 것  </li><li>이를 모르고, pub server는 retry 패턴으로 계속해서 메시지를 보내는 경우가 발생   </li><li>정상적으로 처리가능한 메시지가 지연될 수 있다.  </li><li>처리 불가능한 메시지로 큐가 계속 채워지는 이슈가 발생할 수 있다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결-2">해결<a href="#해결-2" class="hash-link" aria-label="Direct link to 해결" title="Direct link to 해결">​</a></h3><p><img loading="lazy" src="/assets/images/co60-12627af700f378b480b911059621a9e4.png" width="1820" height="908" class="img_ev3q"></p><p>데드 레터 큐를 도입한다.  </p><ul><li>이는 메시지 브로커의 특수한 토픽이다.  </li><li>보내는 방법은 2가지 이</li><li>데드 레터 큐는 시스템이 처리하지 못한 애러메시지들이 쌓여있다.  </li><li>지속적으로 모니터링 및 장애상황을 인지한다.  </li></ul><p>1.Programmatic Publising. </p><ul><li>1.퍼블리셔 : 적절한 토픽이 없는 경우 데드래터큐에 보낸다.  </li><li>2.컨슈머 : 토픽을 적절하게 처리할 수 없는 경우 다시 데드래터큐에 발행한다.  </li></ul><p>2.Automatic transfer (by broker)   </p><ul><li>1.약속되지 않은 토픽을 받으면, 데드레터큐에 보낸다.  </li><li>2.특정 메시지가 아무도 읽지 않고 오래 있는 경우, 메시지 삭제 후 데드레터큐에 보낸다.  </li><li>(* 메시지 브로커에서 지원 가능 여부 확인 )</li></ul><p>Dead Letter 로 보낼 때 적절한 애러 메시지나 코드 등을 넣는 것이 중요하다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="사례">사례<a href="#사례" class="hash-link" aria-label="Direct link to 사례" title="Direct link to 사례">​</a></h3><p>사용자가 장바구니에 상품을 담았다.  </p><ul><li>장바구니에 담긴 상품은 주문 가능하다.  </li><li>해당 상품은 카탈로그가 변경되어 이제 장바구니에 넣는 것이 불가능하다.  </li><li>사용자가 몇 달 후 상품을 주문한다. </li><li>카탈로그가 삭제된 상품에 대해서 재고 처리를 할 수 없는 이슈 발생  </li><li>해당 이슈는 데드래터큐에 들어간다.  </li><li>이를 모니터링 하는 관리자들이 수동으로 처리해 준다. (환불 등 조치)</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-be/0-common/architecture-pattern/co035-cc6.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/g-be/common/architecture-pattern/co033-cc4"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cloud SW 아키텍처 패턴:Extensibility Patterns</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/g-be/common/architecture-pattern/co036-cc7"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cloud SW 아키텍처 패턴:Deployment and Production Testing Patterns</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reliability-error-handling-recovery-patterns" class="table-of-contents__link toc-highlight">Reliability, Error Handling, Recovery Patterns</a></li><li><a href="#throttling-and-rate-limiting-pattern" class="table-of-contents__link toc-highlight">Throttling and Rate Limiting Pattern</a><ul><li><a href="#문제-정의---overconsumption" class="table-of-contents__link toc-highlight">문제 정의 - Overconsumption</a></li><li><a href="#해결" class="table-of-contents__link toc-highlight">해결</a></li><li><a href="#server-side-throttling" class="table-of-contents__link toc-highlight">Server Side throttling</a></li><li><a href="#client-side-throttling" class="table-of-contents__link toc-highlight">Client Side throttling</a></li></ul></li><li><a href="#retry-pattern" class="table-of-contents__link toc-highlight">Retry Pattern</a><ul><li><a href="#문제-정의" class="table-of-contents__link toc-highlight">문제 정의</a></li><li><a href="#해결-1" class="table-of-contents__link toc-highlight">해결</a></li><li><a href="#애러-카테고리화---user-error-vs-system-error" class="table-of-contents__link toc-highlight">애러 카테고리화 - User Error vs System Error</a></li><li><a href="#고려점" class="table-of-contents__link toc-highlight">고려점</a></li></ul></li><li><a href="#circit-breaker-pattern" class="table-of-contents__link toc-highlight">Circit Breaker Pattern</a><ul><li><a href="#문제점" class="table-of-contents__link toc-highlight">문제점</a></li><li><a href="#해결법" class="table-of-contents__link toc-highlight">해결법</a></li><li><a href="#half-open" class="table-of-contents__link toc-highlight">half-open</a></li><li><a href="#고려점-1" class="table-of-contents__link toc-highlight">고려점</a></li></ul></li><li><a href="#dead-letter-queue-pattern-dlq" class="table-of-contents__link toc-highlight">Dead Letter Queue Pattern (DLQ)</a><ul><li><a href="#문제점-1" class="table-of-contents__link toc-highlight">문제점</a></li><li><a href="#해결-2" class="table-of-contents__link toc-highlight">해결</a></li><li><a href="#사례" class="table-of-contents__link toc-highlight">사례</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with themeConfig</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0d44839d.js"></script>
<script src="/assets/js/main.15407641.js"></script>
</body>
</html>