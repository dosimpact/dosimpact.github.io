<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-g-be/common/architecture-pattern/co032-cc3" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Cloud SW 아키텍처 패턴:Performance Patterns | DoDo(도도)의 개발 블로그</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dosimpact.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://dosimpact.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co032-cc3"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="frontend, 취업가이드, 개발자 취업, 포트폴리오, 코테 공부, 개발자 현실, 프론트 개발자"><meta data-rh="true" name="google-site-verification" content="Ov_hk6LqaaE5KiwXnqF2gTKwPxBE3qG5Zr3o5UWZXc8"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cloud SW 아키텍처 패턴:Performance Patterns | DoDo(도도)의 개발 블로그"><meta data-rh="true" name="description" content="- Cloud SW 아키텍처 패턴:Performance Patterns"><meta data-rh="true" property="og:description" content="- Cloud SW 아키텍처 패턴:Performance Patterns"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co032-cc3"><link data-rh="true" rel="alternate" href="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co032-cc3" hreflang="en"><link data-rh="true" rel="alternate" href="https://dosimpact.github.io/docs/g-be/common/architecture-pattern/co032-cc3" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DoDo(도도)의 개발 블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DoDo(도도)의 개발 블로그 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WKPFKPLJJC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WKPFKPLJJC",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.e7581bb8.css">
<link rel="preload" href="/assets/js/runtime~main.96b0a028.js" as="script">
<link rel="preload" href="/assets/js/main.e689cb46.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">DoDo</b></a><a class="navbar__item navbar__link" href="/docs/category/common">👒Front End</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/common-1">🛰️Backend End</a><a class="navbar__item navbar__link" href="/docs/category/common-2">🚧DevOps</a><a class="navbar__item navbar__link" href="/docs/category/python">💎DA</a><a class="navbar__item navbar__link" href="/docs/category/english">💻Hard Skill</a><a class="navbar__item navbar__link" href="/docs/category/아웃풋">🔅Soft Skill</a><a class="navbar__item navbar__link" href="/blog">📝Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dosimpact" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/common-1">Common</a><button aria-label="Toggle the collapsible sidebar category &#x27;Common&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/cloud-sw-아키텍처">Cloud SW 아키텍처</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cloud SW 아키텍처&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co030-cc1">Cloud SW 아키텍처 패턴:소개</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co031-cc2">Cloud SW 아키텍처 패턴:Scalability Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/g-be/common/architecture-pattern/co032-cc3">Cloud SW 아키텍처 패턴:Performance Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co033-cc4">Cloud SW 아키텍처 패턴:Extensibility Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co035-cc6">Cloud SW 아키텍처 패턴:Reliability, Error Handling, Recovery Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/architecture-pattern/co036-cc7">Cloud SW 아키텍처 패턴:Deployment and Production Testing Patterns</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/auth">Auth</a><button aria-label="Toggle the collapsible sidebar category &#x27;Auth&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/g-be/common/co001-sd1">[시스템디자인&amp;인터뷰] 1.확장 가능한 시스템 설계</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/nestjs">NestJS</a><button aria-label="Toggle the collapsible sidebar category &#x27;NestJS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/nodejs">Node.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Node.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sql">Sql</a><button aria-label="Toggle the collapsible sidebar category &#x27;Sql&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/kafka">Kafka</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kafka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/elasticsearch">ElasticSearch</a><button aria-label="Toggle the collapsible sidebar category &#x27;ElasticSearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/common-1"><span itemprop="name">Common</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/cloud-sw-아키텍처"><span itemprop="name">Cloud SW 아키텍처</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cloud SW 아키텍처 패턴:Performance Patterns</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Cloud SW 아키텍처 패턴:Performance Patterns</h1><ul><li><a href="#cloud-sw-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%ED%8C%A8%ED%84%B4performance-patterns">Cloud SW 아키텍처 패턴:Performance Patterns</a><ul><li><a href="#performance-patterns-for-data-intensive-systems">Performance Patterns for Data Intensive Systems</a></li><li><a href="#map-reduce-pattern">Map Reduce Pattern</a><ul><li><a href="#%EB%8C%80%EC%9A%A9%EB%9F%89-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B2%98%EB%A6%AC%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90">대용량 데이터 처리의 문제점</a></li><li><a href="#mapreduce-usecase">MapReduce UseCase</a></li><li><a href="#mapreduce-%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%A1%B0">MapReduce 기본 구조</a></li><li><a href="#mapreduce-%EC%98%88%EC%8B%9C">MapReduce 예시</a></li><li><a href="#%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EA%B5%AC%EC%A1%B0">아키텍처 구조</a></li><li><a href="#%EC%9D%B4%EC%A0%90">이점</a></li><li><a href="#%EC%8B%A4%ED%8C%A8-%EB%B0%8F-%EB%B3%B5%EA%B5%AC-%EC%A0%84%EB%9E%B5">실패 및 복구 전략</a></li><li><a href="#%EA%B3%A0%EB%A0%A4%EC%A0%90">고려점</a></li></ul></li><li><a href="#saga-pattern">Saga Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%95%B4%EA%B2%B0">문제 및 해결</a></li><li><a href="#saga-pattern-%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%A1%B0">Saga Pattern 기본 구조</a></li><li><a href="#%EC%98%88%EC%8B%9C---%EC%BD%98%EC%84%9C%ED%8A%B8-%ED%8B%B0%EC%BC%93-%ED%8C%90%EB%A7%A4-%EC%84%9C%EB%B9%84%EC%8A%A4">예시 - 콘서트 티켓 판매 서비스</a></li><li><a href="#%EC%98%88%EC%8B%9C---%EC%BD%98%EC%84%9C%ED%8A%B8-%ED%8B%B0%EC%BC%93-%ED%8C%90%EB%A7%A4-%EC%84%9C%EB%B9%84%EC%8A%A4---2">예시 - 콘서트 티켓 판매 서비스 - 2</a></li><li><a href="#saga-pattern-%ED%8A%B9%EC%A7%95">Saga Pattern 특징</a></li></ul></li><li><a href="#transactional-outbox-pattern">Transactional Outbox Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C%EC%A0%90">문제점</a></li><li><a href="#%ED%95%B4%EA%B2%B0">해결</a></li><li><a href="#%EA%B0%80%EB%8A%A5%ED%95%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90-1">가능한 문제점 1</a></li><li><a href="#%EA%B0%80%EB%8A%A5%ED%95%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90-2">가능한 문제점 2</a></li><li><a href="#%EA%B0%80%EB%8A%A5%ED%95%9C-%EB%AC%B8%EC%A0%9C%EC%A0%90-3">가능한 문제점 3</a></li><li><a href="#%EA%B2%B0%EB%A1%A0">결론</a></li></ul></li><li><a href="#materialized-view-pattern">Materialized View Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C%EC%A0%90-1">문제점</a></li><li><a href="#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95">해결 방법</a></li><li><a href="#%EC%98%88%EC%8B%9C---%EC%98%A8%EB%9D%BC%EC%9D%B8-%EA%B5%90%EC%98%A5-%ED%94%8C%EB%9E%AB%ED%8F%BC">예시 - 온라인 교옥 플랫폼</a></li><li><a href="#%EA%B3%A0%EB%A0%A4%EC%A0%90-1">고려점</a></li><li><a href="#%EC%BD%94%EB%A9%98%ED%8A%B8">코멘트</a></li></ul></li><li><a href="#cqrs-pattern">CQRS Pattern</a><ul><li><a href="#%EC%9A%A9%EC%96%B4">용어</a></li><li><a href="#%EB%AC%B8%EC%A0%9C-%EC%A0%95%EC%9D%98-1">문제 정의 1</a></li><li><a href="#%EB%AC%B8%EC%A0%9C-%EC%A0%95%EC%9D%98-2">문제 정의 2</a></li><li><a href="#%EA%B8%B0%EB%B3%B8-%EA%B5%AC%EC%A1%B0">기본 구조</a></li><li><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%8F%99%EA%B8%B0%ED%99%94-%EB%B0%A9%EB%B2%95">데이터 동기화 방법</a></li><li><a href="#%EC%9D%B4%EC%A0%90-%EB%B0%8F-%EA%B3%A0%EB%A0%A4%EC%A0%90">이점 및 고려점</a></li><li><a href="#%EC%82%AC%EB%A1%80---%EC%9D%B4%EC%BB%A4%EB%A8%B8%EC%8A%A4">사례 - 이커머스</a></li></ul></li><li><a href="#event-sourcing-pattern">Event Sourcing Pattern</a><ul><li><a href="#%EB%AC%B8%EC%A0%9C-%EC%A0%95%EC%9D%98">문제 정의</a></li><li><a href="#%ED%95%B4%EA%B2%B0%EC%B1%85--%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%86%8C%EC%8B%B1-%ED%8C%A8%ED%84%B4">해결책 : 이벤트 소싱 패턴</a></li><li><a href="#%EC%9D%B4%EB%B2%A4%ED%8A%B8%EB%A5%BC-%EC%A0%80%EC%9E%A5%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95">이벤트를 저장하는 방법</a></li><li><a href="#replay-%EC%A0%84%EB%9E%B5">Replay 전략</a></li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-patterns-for-data-intensive-systems">Performance Patterns for Data Intensive Systems<a href="#performance-patterns-for-data-intensive-systems" class="hash-link" aria-label="Direct link to Performance Patterns for Data Intensive Systems" title="Direct link to Performance Patterns for Data Intensive Systems">​</a></h2><hr><p>2.데이터 집약 시스템을 위한 성능 아키텍처 패턴 - Performance Patterns for Data Intensive Systems   </p><p>데이터 집약 시스템을 위한 성능 패턴을 도입으로 얻는 이점은 무엇일까?  </p><ul><li>아키텍처 변경없이 대용량 데이터 처리  </li><li>분산트랙젝션 가능 (ACID 유지)  </li></ul><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="map-reduce-pattern">Map Reduce Pattern<a href="#map-reduce-pattern" class="hash-link" aria-label="Direct link to Map Reduce Pattern" title="Direct link to Map Reduce Pattern">​</a></h2><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="대용량-데이터-처리의-문제점">대용량 데이터 처리의 문제점<a href="#대용량-데이터-처리의-문제점" class="hash-link" aria-label="Direct link to 대용량 데이터 처리의 문제점" title="Direct link to 대용량 데이터 처리의 문제점">​</a></h3><p>대용량 데이터 세트 처리의 문제점은 데이터 처리를 위해서 수백~수천 대의 머신에 분산처리 시켜야 하는 점이다.  </p><ul><li>데이터 병렬화, 데이터 분산 배포, 결과 추합</li><li>실행 예약, 실패 처리, 복구 문제</li><li>많은 처리 소스 코드 및 인프라 구성  </li></ul><p>맵리듀스 패턴을 사용하면, 아키텍처의 변경없이 많은 양의 데이터를 처리할 수 있는 시스템이 구성된다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce-usecase">MapReduce UseCase<a href="#mapreduce-usecase" class="hash-link" aria-label="Direct link to MapReduce UseCase" title="Direct link to MapReduce UseCase">​</a></h3><ul><li>머신러닝</li><li>로그 파일 필터 및 분석</li><li>역색인 구성</li><li>웹링크 그래프 순회</li><li>분산 정렬  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce-기본-구조">MapReduce 기본 구조<a href="#mapreduce-기본-구조" class="hash-link" aria-label="Direct link to MapReduce 기본 구조" title="Direct link to MapReduce 기본 구조">​</a></h3><p><img loading="lazy" src="/assets/images/co14-5bdfedef61852285d5b13909d8e8a055.png" width="1934" height="936" class="img_ev3q">  </p><p>Input data: key-value 쌍으로 구성된 데이터를 입력  </p><ol><li>Map : Map를 통과하면 중간 key-value쌍이 나오게 된다.  </li><li>intermediate data : Map 중간 key-value 결과물 </li><li>Reduce : Reduce 함수에서 중간 key-value를 grouping하고(정렬) Reduce 로직 수행 후 최종 데이터를 출력한다.
Output data : 최종데이터   </li></ol><ul><li>사실상 위 구조만 봤을때는 잘 이해되지 않는다.    </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce-예시">MapReduce 예시<a href="#mapreduce-예시" class="hash-link" aria-label="Direct link to MapReduce 예시" title="Direct link to MapReduce 예시">​</a></h3><p><img loading="lazy" src="/assets/images/co15-c9288c1923792c71ec1dbf9a71f83812.png" width="1922" height="938" class="img_ev3q">  </p><p>Goal : 수많은 파일들을 분석해서, 특정 단어의 수를 카운트 하자.  </p><p>Input data: key는 파일이름, value는 파일 내용물   </p><ol><li>Map : 각각의 text file을 대상으로 단어의 갯수들을 출력한다. 이는 key-value쌍으로 출력 가능.    </li><li>intermediate data : 각 파일의 단어수가 적힌 key-value 데이터 셋 </li></ol><p><img loading="lazy" src="/assets/images/co17-f22a541cbdfb2e1150782b2ab241ea26.png" width="1572" height="908" class="img_ev3q"><br>
<!-- -->3. Reduce : key값이 단어이므로, 단어순으로 정렬를 먼저 한다. </p><ul><li>그리고 각 단어들의 갯수를 추합하여 최종 데이터를 출력한다.      </li><li>*리듀스 함수를 통과시키는데 key에 대해서 반복자를 돌린다. 중간키에 대한 값이 많아서 메모리에 한번에 로드 불가능   </li></ul><p>Output data : key-value(단어,갯수)의 리스트  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="아키텍처-구조">아키텍처 구조<a href="#아키텍처-구조" class="hash-link" aria-label="Direct link to 아키텍처 구조" title="Direct link to 아키텍처 구조">​</a></h3><p><img loading="lazy" src="/assets/images/co16-972bc937b9984ef9d989aceb121a39ae.png" width="1926" height="906" class="img_ev3q">  </p><p>크게 3가지의 컴포넌트로 구성된다. 마스터노드, 맵워커, 리듀스 워커  </p><p>1.마스터 노드 </p><ul><li>전체 MapReduce 작업 예약 및 컨트롤  </li><li>전체 데이터를 청크단위로 나누어서, Map Workder들에게 할당한다. (실제 데이터 주는것이 아닌 임무를 부여)  </li></ul><p>2.Map Workers  </p><ul><li>Map 함수를 실행하는 수백 ~ 수천개의 컴퓨터  </li><li>그냥 데이터를 저장하지 않고, Region을 분리해서 저장한다.  </li><li>Region = hash(key) mod R : 을 통해서 어떤 Region에 저장할지 결정 가능하다.  </li></ul><p>3.Reduce Workers</p><ul><li>마스터는 각 Region을 담당하고 있는 워커에게 작업을 분배한다.</li><li>리듀스 워커가 데이터를 읽어간다. </li><li>키를 그룹 및 정렬하는 과정 (셔플링) &gt; Reduce 연산을 수행  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="이점">이점<a href="#이점" class="hash-link" aria-label="Direct link to 이점" title="Direct link to 이점">​</a></h3><ul><li>같은 SW아키텍처를 재활용할 수 있다. Map,Reduce함수만 바꾸면 된다. </li><li>테스크의 스케일링이 가능.  </li><li>많은 워커에게 평행하게 작업 분배 가능    </li><li>짧은 시간안에 대용량의 데이터를 처리할 수 있음.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="실패-및-복구-전략">실패 및 복구 전략<a href="#실패-및-복구-전략" class="hash-link" aria-label="Direct link to 실패 및 복구 전략" title="Direct link to 실패 및 복구 전략">​</a></h3><ul><li>마스터가 리듀스 워커들을 관찰하며, 실패한 작업을 다시 다른 워커에게 할당</li><li>맵 워커가 실패한 경우도 다른 워커에게 작업을 할당하며 이때 바뀐 중간 key-value 값위치도 리듀스워커에게 알려야한다.  </li><li>마스터가 장애날 확률은 적지만, 작업에 대한 상태를 스냅샷을 두거나 백업 마스터를 둔다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="고려점">고려점<a href="#고려점" class="hash-link" aria-label="Direct link to 고려점" title="Direct link to 고려점">​</a></h3><ul><li>직접 Map,Reduce 아키텍처를 구성할 일은 없다. </li><li>오픈소스/클라우드 서비스 이용한다.  </li><li>클라우드 환경을 이용해서 필요한 만큼 컴퓨터를 대여하고 반납한다.  <ul><li>ㄴ ( on demand | on scheduled Batch )</li></ul></li><li>시스템은 구성을 신경스지 않고, 비즈니스에 집중 가능하다.<ul><li>ㄴ 데이터모델링, map-reduce 모델링, execution parameters 정의 ..등  </li></ul></li></ul><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saga-pattern">Saga Pattern<a href="#saga-pattern" class="hash-link" aria-label="Direct link to Saga Pattern" title="Direct link to Saga Pattern">​</a></h2><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제-및-해결">문제 및 해결<a href="#문제-및-해결" class="hash-link" aria-label="Direct link to 문제 및 해결" title="Direct link to 문제 및 해결">​</a></h3><p><img loading="lazy" src="/assets/images/co28-dc6f6e44d4ccd3b8c18e32c91c3c53b1.png" width="1330" height="744" class="img_ev3q"></p><p>MSA는 빠른 엔지니어링 속도, 확장성 등 이점이 있다.   </p><ul><li>한가지 중요한 원칙이 마이크로 서비스 하나당 DB가 하나여야 한다.    </li><li>만약에 여러 팀이 DB커넥션을 맺으면, 모든 변경사항에 대해서 합의가 필요하다.  </li><li>이는 마이크로 서비스들이 database를 공유하는것은 MSA안티 패턴이다.  </li></ul><p>하지만 서비스 마다 DB로 분리하는 순간 ACID 트랜잭션 이라는 특성을 잃게 된다.    </p><ul><li>*리마인드) 트랜젝션 : 외부 옵저버에 단일 작업으로 표시돼야 하는 작업의 시퀀스  </li><li>분산 환경에서 데이터의 일관성을 유지하는 방법이 saga패턴이다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saga-pattern-기본-구조">Saga Pattern 기본 구조<a href="#saga-pattern-기본-구조" class="hash-link" aria-label="Direct link to Saga Pattern 기본 구조" title="Direct link to Saga Pattern 기본 구조">​</a></h3><p><img loading="lazy" src="/assets/images/co29-677205930d44be927466d3d036d78b2b.png" width="1622" height="740" class="img_ev3q"></p><p>saga 패턴은 다음의 과정을 통해서 분산환경에서 ACID를 유지 힌다. </p><ul><li>local 트랜젝션1 을 수행하고 다음 서비스에서 트랜젝션 시퀀스를 이어 간다.  </li><li>그러다 만약 작업이 실패하면, 기존에 수행한 작업을 롤백하기 위한 과정이 있다.  </li><li>기존 작업에 대한 보상 작업(보상 트랙젝션) 이라고 한다.  </li><li>*트랜젝션 시퀀스가 성공할때까지 위 과정을 반복한다.  </li></ul><p>saga 패턴 구현방법  </p><ol><li>Orchestrator Pattern : 오케스트레이터 서버로 트렉젝션 시퀀스 및 보상 관리</li><li>Choreography Pattern : 메시지 브로커로 트렉젝션 시퀀스 및 보상 관리</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시---콘서트-티켓-판매-서비스">예시 - 콘서트 티켓 판매 서비스<a href="#예시---콘서트-티켓-판매-서비스" class="hash-link" aria-label="Direct link to 예시 - 콘서트 티켓 판매 서비스" title="Direct link to 예시 - 콘서트 티켓 판매 서비스">​</a></h3><p>요구사항 </p><ul><li>행사 티켓 및 티켓 전용 좌석을 예약    </li><li>블랙리스트 상 유저인지 체크 </li><li>결제금액을 받았는지 체크 </li><li>고객 1명당 1개 좌석인지 체크</li></ul><p><img loading="lazy" src="/assets/images/co30-6136824c11a5dd44baff8186ababebfb.png" width="1534" height="932" class="img_ev3q"></p><p><em>보상 트렌젝션 : pending상태를 원래상태로 되돌리는 트렌젝션<br></em>Pivot Operation : pending상태를 성공상태로 바꾸는 작업들  </p><p>1.Order Service : </p><ul><li>좌석예약 상태로 DB를 업데이트 (pending) 후 이어서 진행  </li><li>pending 상태이므로, 다른 사용자가 같은 자리를 예약 시도 -&gt; 실패 및 retry 안내   </li><li>만약 트랜젝션이 실패하면 다른 사용자가 이용 가능    </li></ul><p>2.Security Service : 사용자가 유효한지 체크  </p><ul><li>만약 블랙리스트라면 rollback ( &gt; Order Service 보상 )</li><li>아니라면 이어서 진행</li></ul><p>3.Billing Service : 3rd party에 결제 시도  </p><ul><li>결제 오류라면 rollback ( &gt; Order Service 보상 )</li><li>아니라면 DB를 업데이트 (pending) 및 결제 (pending) 후 이어서 진행</li></ul><p>4.Reservation Service : 3rd party 좌석 예매 시스템  </p><ul><li>만약 누군가가 이미 예매했다면 rollback ( &gt; Billing Service 보상 &gt; Order Service 보상 )</li><li>아니라면 좌석 티켓 예약 성공 및 DB업데이트 (reserved)  </li></ul><p><img loading="lazy" src="/assets/images/co31-f0b843312862c4d030e9260fb9fb89c2.png" width="1598" height="926" class="img_ev3q"></p><p>5.Pivot Operation </p><ul><li>Billing Servce : pending &gt; 사용자에게 결제 요청 API &gt; 성공 &gt; charged</li><li>Order Service : panding &gt; purchased </li><li>Email Service : 결제성공알람  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시---콘서트-티켓-판매-서비스---2">예시 - 콘서트 티켓 판매 서비스 - 2<a href="#예시---콘서트-티켓-판매-서비스---2" class="hash-link" aria-label="Direct link to 예시 - 콘서트 티켓 판매 서비스 - 2" title="Direct link to 예시 - 콘서트 티켓 판매 서비스 - 2">​</a></h3><p>위 과정을 메시지 브로커를 통해서 작동하도록 로직을 구성한다.  </p><ul><li>메시지 브로커를 사용하면 문제점이 있다.  </li><li>ACID가 지켜지지 않는데, 이는 다음패턴에서 해결  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saga-pattern-특징">Saga Pattern 특징<a href="#saga-pattern-특징" class="hash-link" aria-label="Direct link to Saga Pattern 특징" title="Direct link to Saga Pattern 특징">​</a></h3><ul><li>성공,실패 모두 오퍼레이션이 있다.  </li><li>실패하는 경우 롤백 오퍼레이션 (보상 트렌젝션)    </li><li>성공하는 경우 피봇 오퍼레이션  </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transactional-outbox-pattern">Transactional Outbox Pattern<a href="#transactional-outbox-pattern" class="hash-link" aria-label="Direct link to Transactional Outbox Pattern" title="Direct link to Transactional Outbox Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제점">문제점<a href="#문제점" class="hash-link" aria-label="Direct link to 문제점" title="Direct link to 문제점">​</a></h3><p><img loading="lazy" src="/assets/images/co32-b2d815bafb29facc335e6501c320d930.png" width="1474" height="676" class="img_ev3q">
위 구인구직 추천서비스를 예로들면  </p><ul><li>사용자가 회원가입 이후, 신규 유저 가입 이벤트 메시지를 보내야 한다.  </li><li>DB와 메시지 브로커는 단일 트렉젝션이 아니므로, 충분히 신규 회원가입의 이벤트 메시지를 못받을 수 있다.  </li><li>특히나 결제관련된 이벤트 라면, 영원히 결제 pending 일 수 있다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결">해결<a href="#해결" class="hash-link" aria-label="Direct link to 해결" title="Direct link to 해결">​</a></h3><p><img loading="lazy" src="/assets/images/co33-9594f179de1e79b9b258cd2047b3b47c.png" width="1794" height="936" class="img_ev3q"></p><p>해결방법 : Transactional Outbox Pattern</p><p>1.메시지를 관련 레코드도 DB에 기록한다.   </p><ul><li>( 메시지를 보내야함, 메시지를 성공적으로 보냈음 등의 상태를 Table에 기록한다. )    </li><li>이때, 사용자 생성 Row 및 메시지 레코드는 단일 트랜젝션으로 만든다.  <ul><li>즉 사용자 생성이 안되면, 메시지 레코드 역시 만들어지지 않는것이다.  </li></ul></li></ul><p>2.메시지를 레코드가 생성되면 이를 관찰하는 서비스에서 메시지를 보낸다.  </p><ul><li>메시지 브로커에 메시지가 확실하게 전달되었는지를 확인할 수 있다.  </li><li>그러면 메시지 레코드를 전송완료 상태로 업데이트 한다. 혹은 삭제 한다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="가능한-문제점-1">가능한 문제점 1<a href="#가능한-문제점-1" class="hash-link" aria-label="Direct link to 가능한 문제점 1" title="Direct link to 가능한 문제점 1">​</a></h3><p>Message Relay service가 메시지를 두번 보내는 경우  </p><ul><li>아웃박스 테이블의 메시지 레코드를 읽고 메시지를 보냈음  </li><li>그리고 전송완료로 레코드를 업데이트 하기 전에 서버가 다운되는 경우가 발생</li><li>그러면 동일한 메시지가 2번 전송될 수 있다.  </li></ul><p>만약 메시지 중복이 되더라도 괜찮은 경우가 있다. ( At Least Once ) </p><ul><li>멱등 연산인 경우이다. </li><li>결제처럼 중복이 일어나면 안되는 경우를 멱등연산으로 만들면된다. </li><li>*결제 ID를 부여해서 동일한 결제 ID 로 결제요청이 2번 들어오면 </li><li>최초의 결제만 허용하고, 2번째 결제는 무시하면 된다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="가능한-문제점-2">가능한 문제점 2<a href="#가능한-문제점-2" class="hash-link" aria-label="Direct link to 가능한 문제점 2" title="Direct link to 가능한 문제점 2">​</a></h3><p>atomic transaction을 DB에서 지원하지 않는 경우 </p><ul><li>대표적으로 nosql이 있다.  </li><li>document model에 outbox 데이터 자체를 추가하면 된다. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="가능한-문제점-3">가능한 문제점 3<a href="#가능한-문제점-3" class="hash-link" aria-label="Direct link to 가능한 문제점 3" title="Direct link to 가능한 문제점 3">​</a></h3><p>이벤트의 순서가 중요한 경우</p><ul><li>예를들어 사용자가 구독을 하고, 바로 구독취소를 하는 경우이다.  </li><li>메시지가 - 구독 취소 메시지 후 구독 메시지로 순서가 바뀔 수 있다.  </li><li>outbox 테이블에 시퀀스 ID를 부여해서 해결한다.   </li><li>항상 시퀀스 ID가 낮은 순서대로 메시지를 읽어서 처리해야 한다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="결론">결론<a href="#결론" class="hash-link" aria-label="Direct link to 결론" title="Direct link to 결론">​</a></h3><p>트렌젝션과 다르게 비동기 이벤트를 처리하는 경우 원자성이 보장되지 않을 수 있다.<br>
<!-- -->그럴땐, 비동기 이벤트 처리 로직도 트렌젝션 로직으로 감싸서 처리하여 원자성을 보장하자.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="materialized-view-pattern">Materialized View Pattern<a href="#materialized-view-pattern" class="hash-link" aria-label="Direct link to Materialized View Pattern" title="Direct link to Materialized View Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제점-1">문제점<a href="#문제점-1" class="hash-link" aria-label="Direct link to 문제점" title="Direct link to 문제점">​</a></h3><p><img loading="lazy" src="/assets/images/co34-48484ce3304593f93e1fe7ce95e62446.png" width="1692" height="892" class="img_ev3q"></p><p>비즈니스 로직이 복잡해지면서 여러 테이블의 데이터를 필요한 경우가 있다.  </p><ul><li>복잡한 연산이 필요하거나 ( 합계 )</li><li>데이터 조인이 필요하거나 ( Join )</li><li>하나의 쿼리 자체가 속도가 느려지고 (Performance) </li><li>비용이 비싸질 수 있다. ( Efficiency &amp; Cost )</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결-방법">해결 방법<a href="#해결-방법" class="hash-link" aria-label="Direct link to 해결 방법" title="Direct link to 해결 방법">​</a></h3><p>Materialized View 를 이용해서 해결이 가능하다.  </p><ul><li>구체화된 읽기 전용 테이블(뷰)를 만들어 주는 것이다.  </li><li>쿼리의 결과값들을 미리 채워 둔다.  </li><li>aggrate fun, join 등의 연산 시간과 오버헤드를 줄일 수 있다.  </li><li>이는 동일 database안의 테이블이라면 가능하다. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시---온라인-교옥-플랫폼">예시 - 온라인 교옥 플랫폼<a href="#예시---온라인-교옥-플랫폼" class="hash-link" aria-label="Direct link to 예시 - 온라인 교옥 플랫폼" title="Direct link to 예시 - 온라인 교옥 플랫폼">​</a></h3><p><img loading="lazy" src="/assets/images/co35-c081833ebbae66e40d435bde706c87d5.png" width="1898" height="924" class="img_ev3q"></p><p>시나리오 : 강의에는 수강생들의 후기와 별점들이 남는다.  </p><ul><li>course.topic : 강의의 카테고리 정보   </li><li>reivew : 리뷰 테이블에는 학생아이디, 별점, 리뷰들이 존재한다.  </li><li>쿼리 요청 <ul><li>프로그래밍 카테고리의 강의중에서 평균 별점점이 가장 높은 강의들을 순서대로 정렬해서 가져와라.</li><li>아트 카테고리의 강의중에서 평균 별점점이 가장 높은 강의들을 순서대로 정렬해서 가져와라.</li></ul></li><li>이런 요청들은 하루에 수백 ~ 수천번 일어난다고 가정한다.  </li></ul><p>아래와 같은 뷰 테이블을 미리 만들어준다.  </p><ul><li>Top_Programming_Courses_MV : 프로그래밍 카테고리의 강의별 평균 별점 점수 뷰 테이블</li><li>Top_Art_Courses_MV : 예술 카테고리의 각 강의별 평균 별점 점수 뷰 테이블</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="고려점-1">고려점<a href="#고려점-1" class="hash-link" aria-label="Direct link to 고려점" title="Direct link to 고려점">​</a></h3><p>1.미리 DB 공간을 차지할 만큼 뷰테이블을 만들 가치가 있는가?</p><ul><li>디스크 공간과 성능의 트레이드 오프</li></ul><p>2.데이터 저장을 db에 하는것과 redis에 하는것중 뭐가 더 좋을까?  </p><p>2.1. 동일한 DB안에서 하는 경우에는, View Automatic Update 될 수 있다.  </p><ul><li>하지만 업데이트가 자주 발생한다면, View 갱신 주기를 조정할 필요가 있다.  </li></ul><p><img loading="lazy" src="/assets/images/co36-868757782104685e73815fc02079e088.png" width="1754" height="902" class="img_ev3q"></p><p>2.2. Redis같은 인메모리에 저장한다.  </p><ul><li>Redis + 백업 DB 구조의 이중화가 가능하다.  </li><li>업데이트 방식을 프로그래밍으로 제어해야 한다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="코멘트">코멘트<a href="#코멘트" class="hash-link" aria-label="Direct link to 코멘트" title="Direct link to 코멘트">​</a></h3><p>DB조회가 느린 경우 말고도, 서드파티 API가 느린 경우에도 사용할 수 있겠다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cqrs-pattern">CQRS Pattern<a href="#cqrs-pattern" class="hash-link" aria-label="Direct link to CQRS Pattern" title="Direct link to CQRS Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="용어">용어<a href="#용어" class="hash-link" aria-label="Direct link to 용어" title="Direct link to 용어">​</a></h3><p>Command and Query Responsibility Segregation  </p><ul><li>명령과 쿼리의 역할 분리</li></ul><p>Command : 데이터 Mutation이 발생하는 연산</p><ul><li>사용자 추가, 리뷰 업데이트, 삭제 등</li></ul><p>Query : 데이터를 읽는 연산들  </p><ul><li>특정 카테고리의 모든 프로덕트를 가져와라.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제-정의-1">문제 정의 1<a href="#문제-정의-1" class="hash-link" aria-label="Direct link to 문제 정의 1" title="Direct link to 문제 정의 1">​</a></h3><ul><li>데이터의 빈번한 읽기과 쓰기가 발생한다.  </li><li>데이터의 쓰기가 발생할때 복잡한 로직이 있다.  </li><li>데이터의 읽기연산에 높은 성능이 필요 하다.    </li><li>해결방법 : CQRS Pattern</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제-정의-2">문제 정의 2<a href="#문제-정의-2" class="hash-link" aria-label="Direct link to 문제 정의 2" title="Direct link to 문제 정의 2">​</a></h3><p>MSA환경에서는 DB들이 분리되어 있으므로, 단일 DB안에서 View를 만들 수 없다.  </p><ul><li>이는 programmactic aggregation 으로 가능은하다.  </li><li>하지만 Join 연산도 느린 마당에, 각 MSA 서비스를 호출하고 합치는것은 오버헤드가 크다. </li><li>해결방법 : Materialized View + CQRS Pattern</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="기본-구조">기본 구조<a href="#기본-구조" class="hash-link" aria-label="Direct link to 기본 구조" title="Direct link to 기본 구조">​</a></h3><p><img loading="lazy" src="/assets/images/co37-19df9ef2c8615179fa93e159f499cd79.png" width="1654" height="896" class="img_ev3q"></p><p>Command Service : 비즈니스 로직 처리, 데이터 유효성 검사, 권한 검사 등 (CUD)<br>
<!-- -->Query Service : 데이터를 읽는 로직만 처리한다. (R)</p><ul><li>두 서비스는 독립적으로 분리한다. </li><li>Command DB, Query DB는 지속적으로 동기화 한다.  </li><li>구체화된 뷰 패턴보다 한 단계 더 발전 되었다.  </li><li>각 서비스는 Mutation에 최적화, Query에 최적화된 시스템을 가진다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="데이터-동기화-방법">데이터 동기화 방법<a href="#데이터-동기화-방법" class="hash-link" aria-label="Direct link to 데이터 동기화 방법" title="Direct link to 데이터 동기화 방법">​</a></h3><p><img loading="lazy" src="/assets/images/co39-fc11347f487b517340ab1ff3e4dd9956.png" width="1576" height="946" class="img_ev3q"></p><ul><li>DB와 커넥션으로 직접 데이터를 가져올 수 없다.  </li><li>API 사용도 금지 이다.  </li></ul><p>1.Message Queue 데이터 Sync</p><ul><li>Update/Insert/Delete 가 발생하면</li><li>이벤트를 발생시켜, Query Service가 적절한 조취를 취하도록 한다.  </li><li>이때 트렌젝셔널 아웃박스 패턴도 사용 가능하다.  </li></ul><p>2.Cloud Function 데이터 Sync</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="이점-및-고려점">이점 및 고려점<a href="#이점-및-고려점" class="hash-link" aria-label="Direct link to 이점 및 고려점" title="Direct link to 이점 및 고려점">​</a></h3><p><img loading="lazy" src="/assets/images/co38-3edd5b5b4ef04da741c3cc9cb4a7afd4.png" width="1456" height="950" class="img_ev3q"></p><p>이점</p><ul><li>읽기와 쓰기에 모두 최적화된 시스템을 구성할 수 있다.  </li><li>높은 확장성을 가져간다.   </li></ul><p>트레이드 오프 : 복잡한 시스템 구조를 가져가게 된다.  </p><ul><li>읽기와 쓰기가 매우 많은 경우에 적합하다.  </li><li>실시간으로 데이터의 동기화가 필요하거나, </li><li>데이터의 엄격한 일관성이 필요하다면 적절하지 않다.    </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="사례---이커머스">사례 - 이커머스<a href="#사례---이커머스" class="hash-link" aria-label="Direct link to 사례 - 이커머스" title="Direct link to 사례 - 이커머스">​</a></h3><p><img loading="lazy" src="/assets/images/co42-62b558046ca4c18aa190d207a207f13c.png" width="1632" height="952" class="img_ev3q"></p><p>쓰기 서비스의 복잡성 및 요구사항</p><ul><li>사용자의 주문기록이 있어야 한다.  </li><li>중복된 리뷰를 쓰면 안된다.  </li><li>부적절한 언어가 포함되었는지 확인해야 한다.  </li><li>블랙리스트 회원인지 확인  </li></ul><p>읽기 서비스의 복잡한 요구사항  </p><ul><li>다수의 제품에 대한 모든 후기와 평점 리뷰를 불러와야 한다.  </li><li>사용자의 위치에 따라서 리뷰들도 달라진다.</li><li>사용자의 공용이름 표기 ? </li></ul><p><img loading="lazy" src="/assets/images/co41-d13a745a62a4e151013adea62f46e6f5.png" width="1758" height="924" class="img_ev3q"></p><p>읽기 서비스는 </p><ul><li>리뷰 테이블은 사용자 관련 위치정보등을 포함하기 때문에 데이터를 가져오는데 연산이 적고 필터링이 쉽다.  <ul><li>리뷰 테이블이 업데이트 되면, 메세지를 발행해서 뷰를 갱신. </li><li>리뷰 데이터는 일정량이 쌓이면, 뷰 테이블을 갱신시켜도 된다.  </li></ul></li><li>상품의 평균 평점을 사실 아주 정확할 필요는 없다. 데이터 업데이트 주기를 하루 단위로 가능</li><li>그 외 상품상세설명, 인벤토리, 추천, 트랜딩 데이터 등 확장이 용이하다.  </li><li>NoSQL DB로 구성되며 읽기에 최적화되어있다. </li><li>특별한 비즈니스 로직 유효성 검사 등 필요없고, 퍼블릭에 공개가능한 데이터만 존재한다.  </li></ul><p>스케일업 프로비저닝
<img loading="lazy" src="/assets/images/co40-be56ab4338b5b516d4ade8c288fd20fa.png" width="1778" height="940" class="img_ev3q"></p><ul><li>읽기 연산이 더 필요하면 관련된 서비스들의 인스턴스들을 늘린다.  </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="event-sourcing-pattern">Event Sourcing Pattern<a href="#event-sourcing-pattern" class="hash-link" aria-label="Direct link to Event Sourcing Pattern" title="Direct link to Event Sourcing Pattern">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="문제-정의">문제 정의<a href="#문제-정의" class="hash-link" aria-label="Direct link to 문제 정의" title="Direct link to 문제 정의">​</a></h3><p><img loading="lazy" src="/assets/images/co43-1054e3ac2207158f8d1e83677768e3fd.png" width="1578" height="824" class="img_ev3q"></p><p>온라인 뱅킹에서 현재 잔고 외에 잔고의 히스토리 정보까지 보관해야 한다.  </p><ul><li>Current State + Every State 보관이 필요하다.  </li><li>데이터 시각화, 감사, 정확성을 위해서 필요하다.  </li><li>즉, 히스토리 데이터를 모두 저장하는 것이다.  </li><li>고객의 잘못인지, 시스템 오류인지 등을 알 수 있다.  </li><li>소비 트랜드 또한 알 수 있다.  </li></ul><p>이커머스 서비스에서 이런 경우도 발생  </p><ul><li>최초 제품의 제고량이 200개 이다.  </li><li>판매가 100개 발생 + 어제 물건의 반품이 100개 발생</li><li>그러면 판매가 일어났지만 여전히 재고는 200개 이다.  </li><li>현재 상태에 도달한 기록이 없다.  </li></ul><p>히스토리성 데이터를 많이 쓰고 많이 읽는 서비스에 대한 시스템</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="해결책--이벤트-소싱-패턴">해결책 : 이벤트 소싱 패턴<a href="#해결책--이벤트-소싱-패턴" class="hash-link" aria-label="Direct link to 해결책 : 이벤트 소싱 패턴" title="Direct link to 해결책 : 이벤트 소싱 패턴">​</a></h3><p>사건의 정보 및 변경 사실을 담은 데이터(이벤트)를 기록하는 DB를 저장한다.  </p><ul><li>한번 들어오 데이터는 불변성을 가져야 한다.  </li><li>새로운 이벤트는 Append 된다.  </li><li>이벤트 테이블을 모두 가져온다면, 최초의 상태에서 현재 상태로 복원시킬 수 있다.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="이벤트를-저장하는-방법">이벤트를 저장하는 방법<a href="#이벤트를-저장하는-방법" class="hash-link" aria-label="Direct link to 이벤트를 저장하는 방법" title="Direct link to 이벤트를 저장하는 방법">​</a></h3><p><img loading="lazy" src="/assets/images/co44-4536e532005eb97c4109e4f51de2f709.png" width="1686" height="902" class="img_ev3q"></p><p>1.DB에 저장하는 방법</p><ul><li>이벤트별로 레코드를 분리해서 저장 가능</li><li>많은 쓰기가 발생하면 퍼포먼스가 낮아진다.  </li></ul><p>2.메시지 브로커에 저장하는 방법</p><ul><li>높은 쓰기속도를 가진다.  </li><li>메시지 브로커에 데이터를 영구적으로 저장이 가능한지 체크.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="replay-전략">Replay 전략<a href="#replay-전략" class="hash-link" aria-label="Direct link to Replay 전략" title="Direct link to Replay 전략">​</a></h3><p><img loading="lazy" src="/assets/images/co45-64911dab3f4a0144dd7904ce8ced8027.png" width="1576" height="856" class="img_ev3q"></p><p>1.스냅샷</p><ul><li>특정 시점에 모든 이벤트 로그를 주기적으로 스냅샷을 저장하는 것</li></ul><p><img loading="lazy" src="/assets/images/co46-dbacbef48371ff2ced4aa5c62b2b6d3c.png" width="1270" height="906" class="img_ev3q"></p><p>2.CQRS 패턴</p><ul><li>Event Sourcing + CQRS 패턴은 인기가 많다.</li><li>히스토리와 감사 데이터를 얻을 수 있다. </li><li>읽기 쓰기 모두 빠르게 가져간다.  </li></ul><p>2.1 Redis</p><ul><li>이벤트 데이터를 쓰는 전용 DB를 둔다. (저장)  </li><li>이벤트가 발생되면 이를 Redis에 저장한다. (읽기)  </li></ul><p>2.2 MessageQueue</p><ul><li>이벤트 데이터는 메시지 큐에 저장한다. (저장)</li><li>이벤트가 발생되면 이를 View DB를 갱신한다.(읽기)</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-be/0-common/architecture-pattern/co032-cc3.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/g-be/common/architecture-pattern/co031-cc2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cloud SW 아키텍처 패턴:Scalability Patterns</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/g-be/common/architecture-pattern/co033-cc4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cloud SW 아키텍처 패턴:Extensibility Patterns</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#performance-patterns-for-data-intensive-systems" class="table-of-contents__link toc-highlight">Performance Patterns for Data Intensive Systems</a></li><li><a href="#map-reduce-pattern" class="table-of-contents__link toc-highlight">Map Reduce Pattern</a><ul><li><a href="#대용량-데이터-처리의-문제점" class="table-of-contents__link toc-highlight">대용량 데이터 처리의 문제점</a></li><li><a href="#mapreduce-usecase" class="table-of-contents__link toc-highlight">MapReduce UseCase</a></li><li><a href="#mapreduce-기본-구조" class="table-of-contents__link toc-highlight">MapReduce 기본 구조</a></li><li><a href="#mapreduce-예시" class="table-of-contents__link toc-highlight">MapReduce 예시</a></li><li><a href="#아키텍처-구조" class="table-of-contents__link toc-highlight">아키텍처 구조</a></li><li><a href="#이점" class="table-of-contents__link toc-highlight">이점</a></li><li><a href="#실패-및-복구-전략" class="table-of-contents__link toc-highlight">실패 및 복구 전략</a></li><li><a href="#고려점" class="table-of-contents__link toc-highlight">고려점</a></li></ul></li><li><a href="#saga-pattern" class="table-of-contents__link toc-highlight">Saga Pattern</a><ul><li><a href="#문제-및-해결" class="table-of-contents__link toc-highlight">문제 및 해결</a></li><li><a href="#saga-pattern-기본-구조" class="table-of-contents__link toc-highlight">Saga Pattern 기본 구조</a></li><li><a href="#예시---콘서트-티켓-판매-서비스" class="table-of-contents__link toc-highlight">예시 - 콘서트 티켓 판매 서비스</a></li><li><a href="#예시---콘서트-티켓-판매-서비스---2" class="table-of-contents__link toc-highlight">예시 - 콘서트 티켓 판매 서비스 - 2</a></li><li><a href="#saga-pattern-특징" class="table-of-contents__link toc-highlight">Saga Pattern 특징</a></li></ul></li><li><a href="#transactional-outbox-pattern" class="table-of-contents__link toc-highlight">Transactional Outbox Pattern</a><ul><li><a href="#문제점" class="table-of-contents__link toc-highlight">문제점</a></li><li><a href="#해결" class="table-of-contents__link toc-highlight">해결</a></li><li><a href="#가능한-문제점-1" class="table-of-contents__link toc-highlight">가능한 문제점 1</a></li><li><a href="#가능한-문제점-2" class="table-of-contents__link toc-highlight">가능한 문제점 2</a></li><li><a href="#가능한-문제점-3" class="table-of-contents__link toc-highlight">가능한 문제점 3</a></li><li><a href="#결론" class="table-of-contents__link toc-highlight">결론</a></li></ul></li><li><a href="#materialized-view-pattern" class="table-of-contents__link toc-highlight">Materialized View Pattern</a><ul><li><a href="#문제점-1" class="table-of-contents__link toc-highlight">문제점</a></li><li><a href="#해결-방법" class="table-of-contents__link toc-highlight">해결 방법</a></li><li><a href="#예시---온라인-교옥-플랫폼" class="table-of-contents__link toc-highlight">예시 - 온라인 교옥 플랫폼</a></li><li><a href="#고려점-1" class="table-of-contents__link toc-highlight">고려점</a></li><li><a href="#코멘트" class="table-of-contents__link toc-highlight">코멘트</a></li></ul></li><li><a href="#cqrs-pattern" class="table-of-contents__link toc-highlight">CQRS Pattern</a><ul><li><a href="#용어" class="table-of-contents__link toc-highlight">용어</a></li><li><a href="#문제-정의-1" class="table-of-contents__link toc-highlight">문제 정의 1</a></li><li><a href="#문제-정의-2" class="table-of-contents__link toc-highlight">문제 정의 2</a></li><li><a href="#기본-구조" class="table-of-contents__link toc-highlight">기본 구조</a></li><li><a href="#데이터-동기화-방법" class="table-of-contents__link toc-highlight">데이터 동기화 방법</a></li><li><a href="#이점-및-고려점" class="table-of-contents__link toc-highlight">이점 및 고려점</a></li><li><a href="#사례---이커머스" class="table-of-contents__link toc-highlight">사례 - 이커머스</a></li></ul></li><li><a href="#event-sourcing-pattern" class="table-of-contents__link toc-highlight">Event Sourcing Pattern</a><ul><li><a href="#문제-정의" class="table-of-contents__link toc-highlight">문제 정의</a></li><li><a href="#해결책--이벤트-소싱-패턴" class="table-of-contents__link toc-highlight">해결책 : 이벤트 소싱 패턴</a></li><li><a href="#이벤트를-저장하는-방법" class="table-of-contents__link toc-highlight">이벤트를 저장하는 방법</a></li><li><a href="#replay-전략" class="table-of-contents__link toc-highlight">Replay 전략</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.96b0a028.js"></script>
<script src="/assets/js/main.e689cb46.js"></script>
</body>
</html>