---
sidebar_position: 1
---

# React Query ìš©ë²• 1 

- [React Query ìš©ë²• 1](#react-query-ìš©ë²•-1)
  - [Install](#install)
  - [Basic Convention](#basic-convention)
    - [useSuspenseQuery](#usesuspensequery)
    - [useMutation](#usemutation)
    - [ErrorBoundary](#errorboundary)

## Install  

https://tanstack.com/query/latest/docs/framework/react/installation  
- @tanstack/react-query ì„ ì„¤ì¹˜í•œë‹¤.  
- Query Client ê°ì²´ ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤. ì¤‘ì•™ ì§‘ì¤‘í˜•ê´€ë¦¬ì´ë¯€ë¡œ í•´ë‹¹ ë‹¨ì¼ ê°ì²´ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.  
- Context Providerë¥¼ ì œê³µ   

```tsx
npm i @tanstack/react-query

---
// src/libs/query-client.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 3,
      staleTime: 0,
      gcTime: 0,
    },
  },
});

---
export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      ...
    </QueryClientProvider>
  );
}
```

## Basic Convention  

ì—­í•  ë‹´ë‹¹  
- ê°œì¸ì ì¸ ì»¨ë²¤ì…˜ìœ¼ë¡œ í•´ë‹¹ lib ë””ë ‰í„°ë¦¬ì— useQuery, useMutation ë“¤ì„ ëª¨ì•„ë‘ëŠ”ê²ƒì„ ì¢‹ì•„í•œë‹¤.  
- ìºì‹œ ë¬´íš¨í™” ê´€ë¦¬ëŠ” onSuccessì—ì„œ ì§„í–‰í•˜ëŠ”ê²ƒì„ ì¶”ì²œ.  

### useSuspenseQuery  

- ì¥ì  : ì„ ì–¸í˜•ìœ¼ë¡œ ë°ì´í„° íŒ¨ì¹­, ì• ëŸ¬ì²˜ë¦¬, ë¡œë”©ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.  
- useSuspenseQueryë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ë°ì´í„°ê°€ ë¬´ì¡°ê±´ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ë¡œì§ì„ ì „ê°œí•´ ê°„ë‹¤.  

```tsx
// ì• ëŸ¬ ë°”ìš´ë”ë¦¬ë¥¼ ì„¤ì¹˜ (í˜¹ì€ ì½”ë“œ ì§ì ‘ ì‘ì„±)  
npm i react-error-boundary --save
--- 
// useSuspenseQuery í›… ì„ ì–¸í•˜ê¸°  
import { useSuspenseQuery } from '@tanstack/react-query';
import { TodoListItem } from 'types';

function useQueryTodos() {
  // ì œë„ˆë¦­ íƒ€ì´í•‘ <queryFnì˜ ë°˜í™˜ê°’, ì• ëŸ¬ íƒ€ì…, ìµœì¢… ë°˜í™˜ íƒ€ì…> 
  return useSuspenseQuery<TodoListItem[]>({
    queryKey: ['todos'],
    queryFn: async () => {
      const todos = await getTodos();

      return todos;
    },
  });
}

export default useQueryTodos;
---
// QueryErrorResetBoundaryì˜ resetì„ í˜¸ì¶œí•˜ë©´ retryë¥¼ ì‹œë„í•œë‹¤.  
// ErrorBoundaryëŠ” fallbackRenderì—ì„œ ì „ë‹¬í•´ì£¼ëŠ” resetErrorBoundaryìœ¼ë¡œ ë¦¬ì…‹ ì´ë²¤íŠ¸ë¥¼ ì „íŒŒí•œë‹¤.  
 <QueryErrorResetBoundary>
      {({ reset }) => (
          <ErrorBoundary
            onReset={reset}
            fallbackRender={({ resetErrorBoundary }) => (
              <div style={{ padding: '20px', textAlign: 'center' }}>
                <h3>í•  ì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</h3>
                <button onClick={() => resetErrorBoundary()}>ë‹¤ì‹œ ì‹œë„</button>
              </div>
            )}
          >
            <Suspense fallback={<div>í•  ì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}>
              <TodoList />
            </Suspense>
          </ErrorBoundary>
      )}
  </QueryErrorResetBoundary>
---
// TodoList ì»´í¬ë„ŒíŠ¸
const TodoList = () => {
  const { data: todos } = useQueryTodos();
  ...
};

```

### useMutation

```jsx
import { useMutation } from '@tanstack/react-query';
import { queryClient } from '../query-client';

function useMutationDeleteTodo() {
  return useMutation({
    // mutationFn ì— ë˜í¼ í•¨ìˆ˜ë¥¼ ë„£ëŠ”ë‹¤. TCì—ì„œ Spyë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥.  
    mutationFn: ({ id }: { id: string }) => deleteTodo({ id }),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['todos'] });
    },
  });
}

export default useMutationDeleteTodo;
```

### ErrorBoundary  

ğŸ“Œ ì• ëŸ¬ ë°”ìš´ë”ë¦¬ íƒ€ì… 

```tsx
export type ErrorBoundaryPropsWithComponent = ErrorBoundarySharedProps & {
    fallback?: never;
    FallbackComponent: ComponentType<FallbackProps>;  
    fallbackRender?: never;
};

1.ComponentType vs Renderer
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê´€ì ì—ì„œ ComponentTypeëŠ” í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ë¥¼ í¬í•¨í•˜ëŠ” íƒ€ì…ì´ë‹¤.

// ComponentType<FallbackProps>
type ComponentType<P = {}> = ComponentClass<P> | FunctionComponent<P>;

// FunctionComponent<FallbackProps>
type FunctionComponent<P = {}> = (props: P) => ReactElement | null;


// ì´ë ‡ê²Œ í•˜ë©´ TypeScript ì—ëŸ¬
<ErrorBoundary 
  FallbackComponent={({ error, resetErrorBoundary }) => <div>Error</div>}  // âŒ íƒ€ì… ì—ëŸ¬
>
// ì»´í¬ë„ŒíŠ¸ ì°¸ì¡°ë¥¼ ë„˜ê²¨ì£¼ê±°ë‚˜
<ErrorBoundary FallbackComponent={MyComponent}>

// í˜¹ì€ fallbackRenderì— render functionì„ ë„˜ê²¨ì¤€ë‹¤.  
<ErrorBoundary 
  fallbackRender={({ error, resetErrorBoundary }) => <div>Error</div>}  // âœ… íƒ€ì… ì—ëŸ¬ ì—†ìŒ
>


2.fallback ( React.Element )
// ì•„ë˜ì²˜ëŸ¼ ë¦¬ì•¡íŠ¸ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë„˜ê²¨ì¤€ë‹¤.  
<ErrorBoundary
  fallback={<div>There was an error!</div>}  // ì •ì  JSXë§Œ ê°€ëŠ¥
>
```